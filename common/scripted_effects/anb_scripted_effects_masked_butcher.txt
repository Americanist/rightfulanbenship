no_loyalty_loss_on_vampire_privilege_revocation = {
	custom_tooltip = keepers_dont_care_tt
	hidden_effect = {
		if = {
			limit = {
				has_idea = recognize_hierarchy
			}
			add_estate_loyalty = {
				estate = estate_vampires
				loyalty = 15
			}
		}
		else = {
			add_estate_loyalty = {
				estate = estate_vampires
				loyalty = 20
			}
		}
	}
}

track_mask_granted = {
	if = {
		limit = {
			has_country_flag = $mask_race$_mask_1
			NOT = { has_country_flag = $mask_race$_mask_2 }
		}
		custom_tooltip = mask_current_level_1_tt
	}
	else_if = {
		limit = {
			has_country_flag = $mask_race$_mask_2
			NOT = { has_country_flag = $mask_race$_mask_3 }
		}
		custom_tooltip = mask_current_level_2_tt
	}
	else_if = {
		limit = { 
			has_country_flag = $mask_race$_mask_3 
			NOT = { has_estate_privilege = estate_mages_all_mask }
		}
		custom_tooltip = mask_current_level_3_tt
		if = {
			limit = { has_country_flag = level_3_mask_flg }
			custom_tooltip = mask_level_3_already_tt
		}
		else = {
			set_country_flag = $mask_race$_mask_3_granted
			set_country_flag = level_3_mask_flg
		}
	}
	else_if = {
		limit = {
			has_country_flag = $mask_race$_mask_3
			has_estate_privilege = estate_mages_all_mask
		}
		custom_tooltip = mask_current_level_3_alt_tt
		if = {
			limit = { has_country_flag = 2_level_3_mask_flg }
			custom_tooltip = mask_level_3_already_tt
		}
		else_if = {
			limit = { has_country_flag = level_3_mask_flg }
			set_country_flag = $mask_race$_mask_3_granted
			set_country_flag = 2_level_3_mask_flg
		}
		else = {
			set_country_flag = $mask_race$_mask_3_granted
			set_country_flag = level_3_mask_flg
		}
	}
	else = { custom_tooltip = has_crafted_mask_tt }
}

track_mask_granted_human = {
	if = {
		limit = {
			has_country_flag = $mask_race$_mask_1
			NOT = { has_country_flag = $mask_race$_mask_2 }
		}
		custom_tooltip = mask_current_level_1_tt
	}
	else_if = {
		limit = {
			has_country_flag = $mask_race$_mask_2
			NOT = { has_country_flag = $mask_race$_mask_3 }
		}
		custom_tooltip = mask_current_level_2_tt
	}
	else_if = {
		limit = { 
			has_country_flag = $mask_race$_mask_3 
			NOT = { has_estate_privilege = estate_mages_all_mask }
		}
		custom_tooltip = mask_current_level_3_human_tt
		if = {
			limit = { has_country_flag = level_3_mask_flg }
			custom_tooltip = mask_level_3_already_tt
		}
		else = {
			set_country_flag = $mask_race$_mask_3_granted
			set_country_flag = level_3_mask_flg
		}
	}
	else_if = {
		limit = {
			has_country_flag = $mask_race$_mask_3
			has_estate_privilege = estate_mages_all_mask
		}
		custom_tooltip = mask_current_level_3_human_alt_tt
		if = {
			limit = { has_country_flag = 2_level_3_mask_flg }
			custom_tooltip = mask_level_3_already_tt
		}
		else_if = {
			limit = { has_country_flag = level_3_mask_flg }
			set_country_flag = $mask_race$_mask_3_granted
			set_country_flag = 2_level_3_mask_flg
		}
		else = {
			set_country_flag = $mask_race$_mask_3_granted
			set_country_flag = level_3_mask_flg
		}
	}
	else = { custom_tooltip = has_crafted_mask_tt }
}

revoke_mask_level_check = {
	if = {
		limit = {
			has_country_flag = 2_level_3_mask_flg
			has_country_flag = $mask_race$_mask_3_granted
		}
		clr_country_flag = 2_level_3_mask_flg
		clr_country_flag = $mask_race$_mask_3_granted
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = 2_level_3_mask_flg }
			has_country_flag = $mask_race$_mask_3_granted
		}
		clr_country_flag = level_3_mask_flg
		clr_country_flag = $mask_race$_mask_3_granted
	}
}

apply_mask_opinion = {
	every_country = {
		limit = { culture_is_$race$ = yes }
		reverse_add_opinion = {
			who = THIS
			modifier = mb_made_mask_opinion
		}
	}
}

fire_mask_upgrade_event = {
	if = {
		limit = { NOT = { has_country_flag = $mask_race$_mask_1 } }
		country_event = { id = flavour_maskedbutcher.105 }
		apply_mask_opinion = { race = $race$ }
	}
	else_if = {
		limit = { has_country_flag = $mask_race$_mask_1 NOT = { has_country_flag = $mask_race$_mask_2 } }
		country_event = { id = flavour_maskedbutcher.106 }
	}
	else = {
		country_event = { id = flavour_maskedbutcher.107 }
	}
}

grant_level_1_mask = {
	custom_tooltip = $mask_race$_mask_1_unlock_tt
	set_country_flag = $mask_race$_mask_1
}

grant_level_2_mask = {
	custom_tooltip = $mask_race$_mask_2_unlock_tt
	set_country_flag = $mask_race$_mask_2
	hidden_effect = {
		for = {
			amount = 5
			effect = "
				random_owned_province = {
					limit = {
						has_$race$_majority_trigger = yes
					}
					change_culture = ROOT
					set_province_flag = waiting_for_$mask_race$
					province_event = {
						id = flavour_maskedbutcher.108
						days = 60
					}
				}
			"	
		}
	}
	clr_country_flag = has_$mask_race$_ichor
}

grant_level_3_mask = {
	custom_tooltip = $mask_race$_mask_3_unlock_tt
	set_country_flag = $mask_race$_mask_2
	remove_estate_privilege = estate_vampires_mask_$mask_race$
	custom_tooltip = must_reequip_tt
	custom_tooltip = five_chosen_provinces_tt
	hidden_effect = {
		for = {
			amount = 5
			effect = "
				random_owned_province = {
					limit = { has_$race$_majority_trigger = yes }
					change_culture = ROOT
					set_province_flag = waiting_for_$mask_race$
					province_event = {
						id = flavour_maskedbutcher.108
						days = 60
					}
				}
			"
		}
	}
	clr_country_flag = has_$mask_race$_ichor
}

blood_moon_sacrifice_majority = {
	custom_tooltip = five_chosen_provinces_tt
	hidden_effect = {
		for = {
			amount = 5
			effect = "
				random_owned_province = {
					limit = { has_$race$_majority_trigger = yes }
					change_culture = ROOT
					set_province_flag = waiting_for_$mask_race$
					province_event = {
						id = flavour_maskedbutcher.108
						days = 60
					}
				}
			"
		}
	}
	set_country_flag = has_$mask_race$_ichor
}

blood_moon_sacrifice_minority = {
	custom_tooltip = five_chosen_provinces_minority_tt
	hidden_effect = {
		for = {
			amount = 5
			effect = "
				random_owned_province = {
					limit = { has_$race$_minority_trigger = yes }
					remove_$race$_minority_size_effect = yes
				}
			"
		}
	}
	set_country_flag = has_$mask_race$_ichor
}

add_oblations = {
	if = {
		limit = { event_target:oblations_loser = { NOT = { total_development = 15 } } }
		random_owned_province = {
			limit = { 
				NOT = { 
					has_$race$_majority_trigger = yes
					has_large_$race$_minority_trigger = yes
				} 
			}
			add_$race$_minority_size_effect = yes
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 15 NOT = { total_development = 30 } } }
		for = {
			amount = 2
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 30 NOT = { total_development = 45 } } }
		for = {
			amount = 3
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 45 NOT = { total_development = 60 } } }
		for = {
			amount = 4
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 60 NOT = { total_development = 75 } } }
		for = {
			amount = 5
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 75 NOT = { total_development = 90 } } }
		for = {
			amount = 6
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 90 NOT = { total_development = 105 } } }
		for = {
			amount = 7
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 105 NOT = { total_development = 120 } } }
		for = {
			amount = 8
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 120 NOT = { total_development = 135 } } }
		for = {
			amount = 9
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 135 NOT = { total_development = 150 } } }
		for = {
			amount = 10
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 150 NOT = { total_development = 165 } } }
		for = {
			amount = 11
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 165 NOT = { total_development = 180 } } }
		for = {
			amount = 12
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 195 NOT = { total_development = 210 } } }
		for = {
			amount = 13
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else_if = {
		limit = { event_target:oblations_loser = { total_development = 210 NOT = { total_development = 225 } } }
		for = {
			amount = 14
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	else = {
		for = {
			amount = 15
			effect = "
				random_owned_province = {
					limit = {
						NOT = {
							has_$race$_majority_trigger = yes
							has_large_$race$_minority_trigger = yes
						}
					}
					add_$race$_minority_size_effect = yes
				}
			"
		}
	}
	clear_global_event_target = oblations_loser
}