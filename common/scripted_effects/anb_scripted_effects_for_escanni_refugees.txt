#Increase size of a refugee settlement
increase_escanni_refugee_settlement_size = {
	if = {
		limit = { has_province_modifier = escanni_refugee_settlement_small }
		remove_province_modifier = escanni_refugee_settlement_small
		add_permanent_province_modifier = { 
			name = escanni_refugee_settlement_large
			duration = -1
		}
	}
	else_if = {
		limit = { has_province_modifier = escanni_refugee_settlement_large }
		remove_province_modifier = escanni_refugee_settlement_large
		add_permanent_province_modifier = { 
			name = escanni_refugee_settlement_massive
				duration = -1
		}
	}
	else = {
		add_permanent_province_modifier = { 
			name = escanni_refugee_settlement_small
			duration = -1
		}
	}
}
decrease_escanni_refugee_settlement_size = {
    if = {
		limit = { has_province_modifier = escanni_refugee_settlement_small }
		remove_province_modifier = escanni_refugee_settlement_small
	}	
	else_if = {
		limit = { has_province_modifier = escanni_refugee_settlement_large }
		remove_province_modifier = escanni_refugee_settlement_large
		add_permanent_province_modifier = { 
			name = escanni_refugee_settlement_small
			duration = -1
		}
	}	
	else_if = {
		limit = { has_province_modifier = escanni_refugee_settlement_massive }
		remove_province_modifier = escanni_refugee_settlement_massive
		add_permanent_province_modifier = { 
			name = escanni_refugee_settlement_large
			duration = -1
		}
	}
}
#Scripted effect to decrease the integration level variable and trigger a level change event if it occurs
decrease_escanni_integration_policy = {
	if = {
		limit = { has_country_modifier = escanni_refugee_tolerance }
		remove_country_modifier = escanni_refugee_tolerance
		add_country_modifier = {
			name = escanni_refugee_repatriation
			duration = -1
		}
	}
	if = {
		limit = { has_country_modifier = escanni_refugee_integration }
		remove_country_modifier = escanni_refugee_integration
		add_country_modifier = {
			name = escanni_refugee_tolerance
			duration = -1
		}
	}
}
increase_escanni_integration_policy = {
	if = {
		limit = { has_country_modifier = escanni_refugee_tolerance }
		remove_country_modifier = escanni_refugee_tolerance
		add_country_modifier = {
			name = escanni_refugee_integration
			duration = -1
		}
	}
	if = {
		limit = { has_country_modifier = escanni_refugee_repatriation }
		remove_country_modifier = escanni_refugee_repatriation
		add_country_modifier = {
			name = escanni_refugee_tolerance
			duration = -1
		}
	}
	else = {}
}
#Scripted effects to keep only the right flags on the target provinces
set_flags_escanni_refugees_1_2 = {
	event_target:escanni_migration_target_1 = {
		if = {
			limit = {
				event_target:escanni_center_target_1 = {
					religion = corinite
				}
			}
			clr_province_flag = escanni_migration_target_RC
			clr_province_flag = escanni_migration_target_IC
		}
		if = {
			limit = {
				event_target:escanni_center_target_1 = {
					religion = infernal_court
				}
			}
			clr_province_flag = escanni_migration_target_RC
			clr_province_flag = escanni_migration_target_corinite
		}
		else = {
			clr_province_flag = escanni_migration_target_corinite
			clr_province_flag = escanni_migration_target_IC
		}
	}
	if = {
		limit = { 
			has_saved_event_target = escanni_migration_target_2
		}
		event_target:escanni_migration_target_2 = {
			if = {
				limit = {
					event_target:escanni_center_target_1 = {
						religion = corinite
					}
				}
				clr_province_flag = escanni_migration_target_RC
				clr_province_flag = escanni_migration_target_IC
			}
			if = {
				limit = {
					event_target:escanni_center_target_1 = {
						religion = infernal_court
					}
				}
				clr_province_flag = escanni_migration_target_RC
				clr_province_flag = escanni_migration_target_corinite
			}
			else = {
				clr_province_flag = escanni_migration_target_corinite
				clr_province_flag = escanni_migration_target_IC
			}
		}
	}
}
set_flags_escanni_refugees_3_4 = {
	if = {
		limit = {
			has_saved_event_target = escanni_migration_target_3
		}
		event_target:escanni_migration_target_3 = {
			if = {
				limit = {
					event_target:escanni_center_target_2 = {
						religion = corinite
					}
				}
				clr_province_flag = escanni_migration_target_RC
				clr_province_flag = escanni_migration_target_IC
			}
			if = {
				limit = {
					event_target:escanni_center_target_2 = {
						religion = infernal_court
					}
				}
				clr_province_flag = escanni_migration_target_RC
				clr_province_flag = escanni_migration_target_corinite
			}
			else = {
				clr_province_flag = escanni_migration_target_corinite
				clr_province_flag = escanni_migration_target_IC
			}
		}
	}
	if = {
		limit = {
			has_saved_event_target = escanni_migration_target_4
		}
		event_target:escanni_migration_target_4 = {
			if = {
				limit = {
					event_target:escanni_center_target_2 = {
						religion = corinite
					}
				}
				clr_province_flag = escanni_migration_target_RC
				clr_province_flag = escanni_migration_target_IC
			}
			if = {
				limit = {
					event_target:escanni_center_target_2 = {
						religion = infernal_court
					}
				}
				clr_province_flag = escanni_migration_target_RC
				clr_province_flag = escanni_migration_target_corinite
			}
			else = {
				clr_province_flag = escanni_migration_target_corinite
				clr_province_flag = escanni_migration_target_IC
			}
		}
	}
}
set_flags_escanni_refugees_1_2_no_immediate = {
	europe = {
		type = random
		amount = 2
		limit = {
			OR = {
				region = inner_castanor_region
				region = west_castanor_region
				region = south_castanor_region
				area = cursewood_area
				area = whistlevale_area
			}
			NOT = {
				is_empty = yes
				has_province_flag = escanni_migration_target_RC
				has_province_flag = escanni_migration_target_IC
				has_province_flag = escanni_migration_target_corinite
			}
			owner = {
				OR = {
					NOT = { is_migratory_tribe = yes }
					num_of_cities = 2
				}
				NOT = { has_country_modifier = monstrous_nation }
			}
		}
		if = {
			limit = {
				event_target:escanni_center_target_1 = {
					religion = corinite
				}
			}
			set_province_flag = escanni_migration_target_corinite
		}
		if = {
			limit = {
				event_target:escanni_center_target_1 = {
					religion = infernal_court
				}
			}
			set_province_flag = escanni_migration_target_IC
		}
		else = {
			set_province_flag = escanni_migration_target_RC
			increase_escanni_refugee_settlement_size = yes #debug
		}
	}
}
set_flags_escanni_refugees_escann_side_convert = {
	every_owned_province = {
		limit = {
			OR = {
				has_province_flag = escanni_migration_target_RC
				has_province_flag = escanni_migration_target_IC
				has_province_flag = escanni_migration_target_corinite
			}
		}
		if = {#flee
			limit = {#check availabity of province in Escann
				ROOT = { 
					any_known_country = {
						capital_scope = {
							OR = {
								region = inner_castanor_region
								region = west_castanor_region
								region = south_castanor_region
								area = cursewood_area
								area = whistlevale_area
							}
						}
						any_owned_province = {
							NOT = {
								OR = {
									has_province_flag = escanni_migration_target_RC
									has_province_flag = escanni_migration_target_IC
									has_province_flag = escanni_migration_target_corinite
								}
							}
						}
						OR = {
							NOT = { is_migratory_tribe = yes }
							num_of_cities = 2
						}
						NOT = { has_country_modifier = monstrous_nation }
					}
				}
			}
			if = {#move flag for RC
				limit = {
					has_province_flag = escanni_migration_target_RC
				}
				ROOT = { 
					random_known_country = {
						limit = {
							capital_scope = {
								OR = {
									region = inner_castanor_region
									region = west_castanor_region
									region = south_castanor_region
									area = cursewood_area
									area = whistlevale_area
								}
							}
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							OR = {
								NOT = { is_migratory_tribe = yes }
								num_of_cities = 2
							}
							NOT = { has_country_modifier = monstrous_nation }
						}
						random_owned_province = {
							increase_escanni_refugee_settlement_size = yes #debug
							set_province_flag = escanni_migration_target_RC
						}
					}
				}
				clr_province_flag = escanni_migration_target_RC
			}
			if = {#move flag for IC
				limit = {
					has_province_flag = escanni_migration_target_IC
				}
				ROOT = { 
					random_known_country = {
						limit = {
							capital_scope = {
								OR = {
									region = inner_castanor_region
									region = west_castanor_region
									region = south_castanor_region
									area = cursewood_area
									area = whistlevale_area
								}
							}
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						}
						random_owned_province = {
							increase_escanni_refugee_settlement_size = yes #debug
							set_province_flag = escanni_migration_target_IC
						}
					}
				}
				clr_province_flag = escanni_migration_target_IC
			}
			if = {#move flag for corinite
				limit = {
					has_province_flag = escanni_migration_target_corinite
				}
				ROOT = { 
					random_known_country = {
						limit = {
							capital_scope = {
								OR = {
									region = inner_castanor_region
									region = west_castanor_region
									region = south_castanor_region
									area = cursewood_area
									area = whistlevale_area
								}
							}
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							OR = {
								NOT = { is_migratory_tribe = yes }
								num_of_cities = 2
							}
							NOT = { has_country_modifier = monstrous_nation }
						}
						random_owned_province = {
							increase_escanni_refugee_settlement_size = yes #debug
							set_province_flag = escanni_migration_target_corinite
						}
					}
				}
				clr_province_flag = escanni_migration_target_corinite
			}
		}
		else = {#force settle and convert
			if = {
				limit = { is_city = yes }
				add_random_development = 1
			}
			else = {
				add_colonysize = 100
			}
			add_province_modifier = {
				name = escanni_refugee_discriminate_escann
				duration = 3650
			}
			if = {
				limit = { NOT = { culture_is_human = yes } }
				add_human_minority_size_effect = yes
			}
			if = { #RC
				limit = {
					has_province_flag = escanni_migration_target_RC
					NOT = { religion = regent_court }
				}
				change_religion = regent_court
				clr_province_flag = escanni_migration_target_RC
			}
			if = { #IC
				limit = {
					has_province_flag = escanni_migration_target_IC
					NOT = { religion = infernal_court }
				}
				change_religion = infernal_court
				clr_province_flag = escanni_migration_target_IC
			}
			if = { #corinite
				limit = {
					has_province_flag = escanni_migration_target_corinite
					NOT = { religion = corinite }
				}
				change_religion = corinite
				clr_province_flag = escanni_migration_target_corinite
			}
		}
		decrease_escanni_refugee_settlement_size = yes #debug
	}
}
set_flags_escanni_refugees_escann_side_no_convert = {
	every_owned_province = {
		limit = {
			OR = {
				has_province_flag = escanni_migration_target_RC
				has_province_flag = escanni_migration_target_IC
				has_province_flag = escanni_migration_target_corinite
			}
		}
		if = {#flee
			limit = {#check availabity of province in Escann
				ROOT = { 
					any_known_country = {
						capital_scope = {
							OR = {
								region = inner_castanor_region
								region = west_castanor_region
								region = south_castanor_region
								area = cursewood_area
								area = whistlevale_area
							}
						}
						any_owned_province = {
							NOT = {
								OR = {
									has_province_flag = escanni_migration_target_RC
									has_province_flag = escanni_migration_target_IC
									has_province_flag = escanni_migration_target_corinite
								}
							}
						}
						OR = {
							NOT = { is_migratory_tribe = yes }
							num_of_cities = 2
						}
						NOT = { has_country_modifier = monstrous_nation }
					} 
				}
			}
			if = {#move flag for RC
				limit = {
					has_province_flag = escanni_migration_target_RC
				}
				ROOT = { 
					random_known_country = {
						limit = {
							capital_scope = {
								OR = {
									region = inner_castanor_region
									region = west_castanor_region
									region = south_castanor_region
									area = cursewood_area
									area = whistlevale_area
								}
							}
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						}
						random_owned_province = {
							increase_escanni_refugee_settlement_size = yes #debug
							set_province_flag = escanni_migration_target_RC
						}
					}
				}
				clr_province_flag = escanni_migration_target_RC
			}
			if = {#move flag for IC
				limit = {
					has_province_flag = escanni_migration_target_IC
				}
				ROOT = { 
					random_known_country = {
						limit = {
							capital_scope = {
								OR = {
									region = inner_castanor_region
									region = west_castanor_region
									region = south_castanor_region
									area = cursewood_area
									area = whistlevale_area
								}
							}
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						}
						random_owned_province = {
							increase_escanni_refugee_settlement_size = yes #debug
							set_province_flag = escanni_migration_target_IC
						}
					}
				}
				clr_province_flag = escanni_migration_target_IC
			}
			if = {#move flag for corinite
				limit = {
					has_province_flag = escanni_migration_target_corinite
				}
				ROOT = { 
					random_known_country = {
						limit = {
							capital_scope = {
								OR = {
									region = inner_castanor_region
									region = west_castanor_region
									region = south_castanor_region
									area = cursewood_area
									area = whistlevale_area
								}
							}
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						}
						random_owned_province = {
							increase_escanni_refugee_settlement_size = yes #debug
							set_province_flag = escanni_migration_target_corinite
						}
					}
				}
				clr_province_flag = escanni_migration_target_corinite
			}
		}
		else = {#force settle no convert
			if = {
				limit = { is_city = yes }
				add_random_development = 1
			}
			else = {
				add_colonysize = 100
			}
			add_province_modifier = {
				name = escanni_refugee_discriminate_escann
				duration = 3650
			}
			if = {
				limit = { NOT = { culture_is_human = yes } }
				add_human_minority_size_effect = yes
			}
			if = { #RC
				limit = {
					has_province_flag = escanni_migration_target_RC
					NOT = { religion = regent_court }
				}
				clr_province_flag = escanni_migration_target_RC
			}
			if = { #IC
				limit = {
					has_province_flag = escanni_migration_target_IC
					NOT = { religion = infernal_court }
				}
				clr_province_flag = escanni_migration_target_IC
			}
			if = { #corinite
				limit = {
					has_province_flag = escanni_migration_target_corinite
					NOT = { religion = corinite }
				}
				clr_province_flag = escanni_migration_target_corinite
			}
		}
		decrease_escanni_refugee_settlement_size = yes #debug
	}
}
#Scripted effect to for refugee events affecting 1 center and flagging 2 provinces in Escann
define_event_targets_escanni_refugees_1_center = {
	random_owned_province = {
		limit = {
			has_escanni_refugees = yes
		}
		save_event_target_as = escanni_center_target_1
	}
	event_target:escanni_center_target_1 = {
		random_area_province = {
			limit = {
				owned_by = ROOT
			}
			save_event_target_as = escanni_effect_target_1
		}
		random_area_province = {
			limit = {
				owned_by = ROOT
				NOT = { province_id = event_target:escanni_effect_target_1 }
			}
			save_event_target_as = escanni_effect_target_2
		}
	}
	europe = {
		type = random
		amount = 2
		limit = {
			OR = {
				region = inner_castanor_region
				region = west_castanor_region
				region = south_castanor_region
				area = cursewood_area
				area = whistlevale_area
			}
			NOT = {
				is_empty = yes
				has_province_flag = escanni_migration_target_RC
				has_province_flag = escanni_migration_target_IC
				has_province_flag = escanni_migration_target_corinite
			}
			owner = {
				OR = {
					NOT = { is_migratory_tribe = yes }
					num_of_cities = 2
				}
				NOT = { has_country_modifier = monstrous_nation }
			}
		}
		if = {
			limit = {
				NOT = { has_saved_event_target = escanni_migration_target_1 }
			}
			save_event_target_as = escanni_migration_target_1
			increase_escanni_refugee_settlement_size = yes #debug
			set_province_flag = escanni_migration_target_IC
			set_province_flag = escanni_migration_target_RC
			set_province_flag = escanni_migration_target_corinite
		}
		if = {
			limit = {
				NOT = { province_id = event_target:escanni_migration_target_1 }
				NOT = { has_saved_event_target = escanni_migration_target_2 }
			}
			save_event_target_as = escanni_migration_target_2
			increase_escanni_refugee_settlement_size = yes #debug
			set_province_flag = escanni_migration_target_IC
			set_province_flag = escanni_migration_target_RC
			set_province_flag = escanni_migration_target_corinite
		}
	}
}
define_event_targets_escanni_refugees_2_center = {
	random_owned_province = {
		limit = {
			has_escanni_refugees = yes
		}
		save_event_target_as = escanni_center_target_1
	}
	event_target:escanni_center_target_1 = {
		random_area_province = {
			limit = {
				owned_by = ROOT
			}
			save_event_target_as = escanni_effect_target_1
		}
		random_area_province = {
			limit = {
				owned_by = ROOT
				NOT = { province_id = event_target:escanni_effect_target_1 }
			}
			save_event_target_as = escanni_effect_target_2
		}
	}
	random_owned_province = {
		limit = {
			has_escanni_refugees = yes
			NOT = { province_id = event_target:escanni_center_target_1 }
		}
		save_event_target_as = escanni_center_target_2
	}
	if = {
		limit = { has_saved_event_target = escanni_center_target_2 }
		event_target:escanni_center_target_2 = {
			random_area_province = {
				limit = {
					owned_by = ROOT
				}
				save_event_target_as = escanni_effect_target_3
			}
			random_area_province = {
				limit = {
					owned_by = ROOT
					has_saved_event_target = escanni_effect_target_3
					NOT = { province_id = event_target:escanni_effect_target_3 }
				}
				save_event_target_as = escanni_effect_target_4
			}
		}
	}
	europe = {
		type = random
		amount = 4
		limit = {
			OR = {
				region = inner_castanor_region
				region = west_castanor_region
				region = south_castanor_region
				area = cursewood_area
				area = whistlevale_area
			}
			NOT = { #NOR
				is_empty = yes
				has_province_flag = escanni_migration_target_RC
				has_province_flag = escanni_migration_target_IC
				has_province_flag = escanni_migration_target_corinite
			}
			owner = {
				OR = {
					NOT = { is_migratory_tribe = yes }
					num_of_cities = 2
				}
				NOT = { has_country_modifier = monstrous_nation }
			}
		}
		if = {
			limit = {
				NOT = { has_saved_event_target = escanni_migration_target_1 }
			}
			save_event_target_as = escanni_migration_target_1
			increase_escanni_refugee_settlement_size = yes #debug
			set_province_flag = escanni_migration_target_IC
			set_province_flag = escanni_migration_target_RC
			set_province_flag = escanni_migration_target_corinite
		}
		if = {
			limit = {
				NOT = { province_id = event_target:escanni_migration_target_1 }
				NOT = { has_saved_event_target = escanni_migration_target_2 }
			}
			save_event_target_as = escanni_migration_target_2
			increase_escanni_refugee_settlement_size = yes #debug
			set_province_flag = escanni_migration_target_IC
			set_province_flag = escanni_migration_target_RC
			set_province_flag = escanni_migration_target_corinite
		}
		if = {
			limit = {
				NOT = { province_id = event_target:escanni_migration_target_1 }
				NOT = { province_id = event_target:escanni_migration_target_2 }
				NOT = {
					has_saved_event_target = escanni_migration_target_3
				}
			}
			save_event_target_as = escanni_migration_target_3
			increase_escanni_refugee_settlement_size = yes #debug
			set_province_flag = escanni_migration_target_IC
			set_province_flag = escanni_migration_target_RC
			set_province_flag = escanni_migration_target_corinite
		}
		if = {
			limit = {
				NOT = { province_id = event_target:escanni_migration_target_1 }
				NOT = { province_id = event_target:escanni_migration_target_2 }
				NOT = { province_id = event_target:escanni_migration_target_3 }
				NOT = { has_saved_event_target = escanni_migration_target_4 }
			}
			save_event_target_as = escanni_migration_target_4
			increase_escanni_refugee_settlement_size = yes #debug
			set_province_flag = escanni_migration_target_IC
			set_province_flag = escanni_migration_target_RC
			set_province_flag = escanni_migration_target_corinite
		}
	}
}