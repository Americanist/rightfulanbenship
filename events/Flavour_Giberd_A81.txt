# Giberd MT events
# 1-9: old events
# 10-19: mission flavour events
# 20-29: electorate event chain
# 30-39: artificer faction events
namespace = flavor_giberd
#Nimscodd Aid
country_event = {
	id = flavor_giberd.1
	title = flavor_giberd.1.t
	desc = flavor_giberd.1.d
	picture = GREAT_BUILDING_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.1.a
		add_treasury = 100
		add_country_modifier = {
			name = giberd_aid_from_giberd
			duration = 7300			#20 years
		}
	}
}

#Gnomish Elector
country_event = {
	id = flavor_giberd.2
	title = flavor_giberd.2.t
	desc = flavor_giberd.2.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.2.a
		ai_chance = {
			factor = 100
		}
		add_imperial_influence = 10
		add_country_modifier = {
			name = giberd_gnomish_elector_mod
			duration = -1
		}
		A81 = {
			#Giberd
			if = {
				limit = {
					ai = yes
				}
				add_opinion = {
					who = ROOT
					modifier = grant_electorate
				}
			}
			elector = yes
			set_country_flag = gnomish_elector
			country_event = {
				id = flavor_giberd.3
			}
		}
	}
	option = {
		name = flavor_giberd.2.b
		ai_chance = {
			factor = 0
		}
		add_imperial_influence = -5
		A81 = {
			#Giberd
			if = {
				limit = {
					ai = yes
				}
				add_opinion = {
					who = ROOT
					modifier = giberd_refused_electorate
				}
			}
			country_event = {
				id = flavor_giberd.3
			}
		}
	}
}

#Gnomish Elector accepted
country_event = {
	id = flavor_giberd.3
	title = flavor_giberd.3.t
	desc = flavor_giberd.3.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.3.a
		add_prestige = 10
		tooltip = {
			elector = yes
		}
	}
}

#Gnomish Elector refused
country_event = {
	id = flavor_giberd.4
	title = flavor_giberd.4.t
	desc = flavor_giberd.4.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.4.a
		add_prestige = -10
	}
}

# Reworked Giberd MT events
#Our Options of War
country_event = {
	id = flavor_giberd.10
	title = flavor_giberd.10.t
	desc = flavor_giberd.10.d
	is_triggered_only = yes
	immediate = {
		# TODO: implement research speed / inability to research
		hidden_effect = {
			#Artificery Local Setup
			set_country_flag = artificery_unlocked			#failsave
			artifice_inventions_give_basket = yes
			update_artifice_points = yes
			clear_artificers_organization_effect = yes
			set_estate_privilege = estate_artificers_organization_giberd_magisterium_oversight
			bennonhill_area = {
				add_permanent_claim = ROOT
			}
			hearthswood_area = {
				add_permanent_claim = ROOT
			}
		}
	}
	option = {
		name = flavor_giberd.10.a
		goto = 273		#Tendergrove
		add_country_modifier = {
			name = giberd_options_war_leslinpar
			duration = 3560
		}
		add_treasury = -50
		random_owned_province = {
			limit = {
				infantry_in_province = 2
				infantry_in_province = ROOT
			}
			kill_units = {
				who = owner
				type = infantry
				amount = 2
			}
			rajput_infantry = ROOT
			rajput_infantry = ROOT
		}
		custom_tooltip = giberd_unable_to_research_10
		custom_tooltip = giberd_ae_gnomish_minority_tt
		custom_tooltip = giberd_magisterium_oversight_tt
		custom_tooltip = has_already_happened_tt
		tooltip = {
			bennonhill_area = {
				add_permanent_claim = ROOT
			}
			hearthswood_area = {
				add_permanent_claim = ROOT
			}
		}
		set_estate_privilege = estate_artificers_organization_giberd_magisterium_oversight
	}
	option = {
		name = flavor_giberd.10.b
		goto = 268		#Bennon
		custom_tooltip = giberd_bennon_forts_explode_tt
		tooltip = {
			268 = {
				add_province_modifier = {
					name = giberd_options_war_bennon
					duration = 1825
				}
			}
		}
		add_treasury = -50
		random_owned_province = {
			limit = {
				infantry_in_province = 2
				infantry_in_province = ROOT
			}
			kill_units = {
				who = owner
				type = infantry
				amount = 2
			}
			rajput_infantry = ROOT
			rajput_infantry = ROOT
		}
		custom_tooltip = giberd_unable_to_research_10		# TODO: Implement
		custom_tooltip = giberd_ae_gnomish_minority_tt
		custom_tooltip = giberd_magisterium_oversight_tt
		custom_tooltip = has_already_happened_tt
		tooltip = {
			bennonhill_area = {
				add_permanent_claim = ROOT
			}
			hearthswood_area = {
				add_permanent_claim = ROOT
			}
		}
		set_estate_privilege = estate_artificers_organization_giberd_magisterium_oversight
	}
	option = {
		name = flavor_giberd.10.c
		add_prestige = 20
		add_country_modifier = {
			name = giberd_options_war_peace
			duration = 3650
		}
		custom_tooltip = giberd_research_speed_tt		# TODO: Implement
		custom_tooltip = giberd_ae_gnomish_minority_tt		# TODO: Implement
		custom_tooltip = giberd_magisterium_oversight_tt
		custom_tooltip = has_already_happened_tt
		tooltip = {
			bennonhill_area = {
				add_permanent_claim = ROOT
			}
			hearthswood_area = {
				add_permanent_claim = ROOT
			}
		}
		set_estate_privilege = estate_artificers_organization_giberd_magisterium_oversight
	}
}

#Silver Linings are Laced in Gold
country_event = {
	id = flavor_giberd.11
	title = flavor_giberd.11.t
	desc = flavor_giberd.11.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.11.a
		add_favors = {
			who = A73
			amount = 20
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
			}
			add_country_modifier = {
				name = giberd_silverforge_favour_accepted
				duration = 3650
			}
		}
		else = {
			random_owned_province = {
				limit = {
					infantry_in_province = 2
					infantry_in_province = ROOT
				}
				kill_units = {
					who = owner
					type = infantry
					amount = 2
				}
				rajput_infantry = ROOT
				rajput_infantry = ROOT
			}
		}
	}
	option = {
		name = flavor_giberd.11.b
		add_country_modifier = {
			name = giberd_silverforge_favour_rejected
			duration = 5475
		}
	}
}

# Esmaraine challenges our Bid
country_event = {
	id = flavor_giberd.12
	title = flavor_giberd.12.t
	desc = flavor_giberd.12.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.12.a
		add_prestige = -20
		add_historical_rival = A44
	}
}

# finishing the gds loopeng gedsandde
# country_event = {
# 	id = flavor_giberd.13
# 	title = flavor_giberd.13.t
# 	desc = flavor_giberd.13.d
# 	picture = HRE_eventPicture
# 	is_triggered_only = yes
# 	option = {
# 		name = flavor_giberd.13.a
# 	}
# }
# Convincing the emperor
country_event = {
	id = flavor_giberd.14
	title = flavor_giberd.14.t
	desc = flavor_giberd.14.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		# TODO: unlock tier 2 inventions
		name = flavor_giberd.14.a
		custom_tooltip = giberd_increases_our_artifice_upkeep_by_20
		custom_tooltip = artificer_points_upkeep_tt
		hidden_effect = {
			change_variable = {
				which = ArtificeUpkeep
				value = 20
			}
		}
		update_artifice_points = yes
		hidden_effect = {
			emperor = {
				country_event = {
					id = flavor_giberd.16
					days = 1
				}
			}
		}
	}
}

# The first Gnomish elector
country_event = {
	id = flavor_giberd.15
	title = flavor_giberd.15.t
	desc = flavor_giberd.15.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.15.a
		elector = ROOT
		country_event = {
			id = flavor_esmari.1
			days = 1
		}
		# TODO: unlock level 2 inventions
	}
}

# Giberd asks for an Electorate
country_event = {
	id = flavor_giberd.16
	title = flavor_giberd.16.t
	desc = flavor_giberd.16.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.16.a
		ai_chance = {
			factor = 100
		}
		A81 = {
			country_event = {
				id = flavor_giberd.15
				days = 30
			}
			hidden_effect = {
				country_event = {
					id = flavor_giberd.17
					days = 3650
				}
			}
		}
		if = {
			limit = {
				emperor = {
					ai = no
				}
			}
			country_event = {
				id = flavor_giberd.17
				days = 3650
			}
		}
	}
	option = {
		name = flavor_giberd.16.b
		ai_chance = {
			factor = 0
		}
		A81 = {
			hidden_effect = {
				subtract_variable = {
					which = ArtificeUpkeep
					value = 20
				}
			}
		}
	}
}

# The Mechanical Dragon
country_event = {
	id = flavor_giberd.17
	title = flavor_giberd.17.t
	desc = flavor_giberd.17.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.17.a
		if = {
			limit = {
				tag = A81
			}
			artifice_remove_20 = yes
		}
		emperor = {
			add_country_modifier = {
				name = giberd_mechanical_dragon
				duration = 3650
			}
		}
	}
}

########
# electorate event chain
# The Art of Promises, Paycheques and Propositions
country_event = {
	id = flavor_giberd.20
	title = flavor_giberd.20.t
	desc = flavor_giberd.20.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.20.a
	}
}

########
# artificer faction events
# The Imperial Archive
country_event = {
	id = flavor_giberd.30
	title = flavor_giberd.30.t
	desc = flavor_giberd.30.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.30.a
	}
}

# Addressing the Damestear demand
country_event = {
	id = flavor_giberd.31
	title = flavor_giberd.31.t
	desc = flavor_giberd.31.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		# technomancers
		name = flavor_giberd.31.a
		goto = 265
		giberd_factions_technomancers_increase = yes
		265 = {
			change_trade_goods = damestear
			set_province_flag = permanent_damestear
			add_province_modifier = {
				name = giberd_damestear_port_high
				duration = -1
			}
		}
		add_treasury = -2000
		add_country_modifier = {
			name = giberd_paying_the_moonisle
			duration = -1
		}
		custom_tooltip = flavor_giberd.32.war_tt		# TODO: implement
	}
	option = {
		# brillites
		name = flavor_giberd.31.b
		goto = 265
		giberd_factions_brillites_increase = yes
		country_event = {
			id = flavor_giberd.32
			days = 1
		}
		tooltip = {
			add_treasury = -500
		}
	}
	option = {
		# mechanists
		name = flavor_giberd.31.c
		goto = 9
		giberd_factions_mechanists_increase = yes
		9 = {
			add_permanent_claim = ROOT
		}
	}
}

# Short term low amount renewable deal for Damestear
country_event = {
	id = flavor_giberd.32
	title = flavor_giberd.32.t
	desc = flavor_giberd.32.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		# yes
		name = flavor_giberd.32.a
		custom_tooltip = flavor_giberd.32.accept_tt
		add_treasury = -500
		if = {
			limit = {
				265 = {
					NOT = {
						has_province_modifier = giberd_damestear_port_low
					}
				}
			}
			hidden_effect = {
				265 = {
					add_province_modifier = {
						name = giberd_damestear_port_low
						duration = -1
					}
				}
			}
			hidden_effect = {
				change_variable = {
					which = StaticArtificePoints
					value = 3
				}
			}
			update_artifice_points = yes
		}
	}
	option = {
		# no
		name = flavor_giberd.32.b
		custom_tooltip = flavor_giberd.32.reject_tt
		if = {
			limit = {
				265 = {
					has_province_modifier = giberd_damestear_port_low
				}
			}
			remove_province_modifier = giberd_damestear_port_low
			hidden_effect = {
				subtract_variable = {
					which = StaticArtificePoints
					value = 3
				}
				update_artifice_points = yes
			}
		}
	}
	after = {
		country_event = {
			id = flavor_giberd.32
			days = 3650
		}
	}
}

# Esmaria's last port of call
country_event = {
	id = flavor_giberd.33
	title = flavor_giberd.33.t
	desc = flavor_giberd.33.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.33.a
		giberd_factions_technomancers_increase = yes
		add_country_modifier = {
			name = giberd_estallen_share
			duration = -1
		}
		home_trade_node_effect_scope = {
			add_trade_modifier = {
				who = ROOT
				duration = -1
				power = 100
				key = giberd_estallen_trade_deal
			}
			add_trade_modifier = {
				who = A93
				duration = -1
				power = -100
				key = giberd_estallen_trade_deal
			}
			every_trade_node_member_province = {
				limit = {
					owned_by = A93
				}
				add_province_modifier = {
					name = giberd_business_ventures
					duration = -1
				}
			}
		}
		custom_tooltip = flavor_giberd.33.war_tt		# TODO: implement
	}
	option = {
		name = flavor_giberd.33.b
		giberd_factions_brillites_increase = yes
		add_manpower = -20
		280 = {
			add_permanent_province_modifier = {
				name = giberd_lock_out_estallen
				duration = -1
			}
			owner = {
				add_country_modifier = {
					name = giberd_estallen_embargo
					duration = 9125
				}
			}
		}
	}
	option = {
		name = flavor_giberd.33.c
		giberd_factions_mechanists_increase = yes
		280 = {
			add_permanent_claim = ROOT
		}
		576 = {
			add_permanent_claim = ROOT
		}
		301 = {
			add_permanent_claim = ROOT
		}
	}
}

# Silverforge's due
country_event = {
	id = flavor_giberd.34
	title = flavor_giberd.34.t
	desc = flavor_giberd.34.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	option = {
		name = flavor_giberd.34.a
		giberd_factions_technomancers_increase = yes
		custom_tooltip = giberd_construction_of_silverforge_large_tt
		custom_tooltip = artificer_points_upkeep_tt
		set_country_flag = giberd_silverforge_hold_large
		hidden_effect = {
			change_variable = {
				which = ArtificeUpkeep
				value = 30
			}
		}
		update_artifice_points = yes
		add_country_modifier = {
			name = giberd_paying_for_silverforge
			duration = 3650
		}
		912 = {
			add_province_modifier = {
				name = giberd_silverforge_hold
				duration = -1
			}
		}
		custom_tooltip = giberd_silverforge_war_tt		# TODO: implement
		large_increase_of_dwarven_tolerance_effect = yes
		for = {
			custom_tooltip = giberd_10_provinces_get_dwarves_tt
			amount = 10
			effect = "random_province = { limit = { region = esmaria_region } add_dwarven_minority_size_effect = yes }"
		}
	}
	option = {
		name = flavor_giberd.34.b
		giberd_factions_brillites_increase = yes
		custom_tooltip = giberd_construction_of_silverforge_small_tt
		set_country_flag = giberd_silverforge_hold_small
		custom_tooltip = artificer_points_upkeep_tt
		hidden_effect = {
			change_variable = {
				which = ArtificeUpkeep
				value = 10
			}
		}
		update_artifice_points = yes
		for = {
			custom_tooltip = giberd_2_provinces_get_dwarves_tt
			amount = 2
			effect = "random_province = { limit = { region = esmaria_region } add_dwarven_minority_size_effect = yes }"
		}
	}
	option = {
		name = flavor_giberd.35.a
		giberd_factions_mechanists_increase = yes
		remove_historical_friend = A73
		A73 = {
			add_casus_belli = {
				type = cb_insult
				target = ROOT
				months = 120
			}
		}
		308 = {
			add_permanent_claim = ROOT
		}
		912 = {
			add_permanent_claim = ROOT
		}
	}
	after = {
		hidden_effect = {
			country_event = {
				id = flavor_giberd.35
				days = 3650
			}
		}
	}
}

# cleanup after .34
country_event = {
	id = flavor_giberd.35
	title = flavor_giberd.35.t
	desc = flavor_giberd.35.d
	picture = HRE_eventPicture
	is_triggered_only = yes
	hidden = yes
	option = {
		name = flavor_giberd.34.a
		if = {
			limit = {
				has_country_flag = giberd_silverforge_hold_large
			}
			clr_country_flag = giberd_silverforge_hold_large
			subtract_variable = {
				which = ArtificeUpkeep
				value = 30
			}
		}
		if = {
			limit = {
				has_country_flag = giberd_silverforge_hold_small
			}
			clr_country_flag = giberd_silverforge_hold_small
			subtract_variable = {
				which = ArtificeUpkeep
				value = 10
			}
		}
	}
}
