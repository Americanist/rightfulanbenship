namespace = escanni_refugees_settlement

#100+ Base system event
country_event = {#The final flight of the Escanni
	id = escanni_refugees_settlement.100
	title = "escanni_refugees_settlement.100.t"
	picture = REFUGEES_ESCAPING_eventPicture

	desc = {
		trigger = {NOT = { is_year = 1446 } }
		desc = "escanni_refugees_settlement.100.d"
	}
	desc = {
		trigger = { is_year = 1446 }
		desc = "escanni_refugees_settlement.100.d2"
	}
	
	trigger = {
		NOT = {
			has_country_flag = escanni_refugees_arrived
		}
	}
	
	immediate = {
		hidden_effect = {
			set_country_flag = escanni_refugees_arrived
		}
	}

	option = {
		name = escanni_refugees_settlement.100.a
		ai_chance = { factor = 1 }
		custom_tooltip = escanni_refugees_settlement_100_tt
		
		trigger = {
			NOT = { is_year = 1446 }
		}
		if = {
			limit = {
				OR = {
					tag = A46 #Arbaran
					tag = A13 #Gawed
				}
			}
			add_country_modifier = {
				name = escanni_refugee_integration
				duration = -1
			}
		}
		else_if = {
			limit = {
				tag = A59 #Corvuria
			}
			add_country_modifier = {
				name = escanni_refugee_repatriation
				duration = -1
			}
		}
		else = {
			add_country_modifier = {
				name = escanni_refugee_tolerance
				duration = -1
			}
		}
	}

	option = {
		name = escanni_refugees_settlement.100.b
		ai_chance = { factor = 1 }
		custom_tooltip = escanni_refugees_settlement_100_tt
		
		trigger = {
			is_year = 1446
		}

		add_adm_power = -20
		add_dip_power = -20

		custom_tooltip = escanni_refugees_settlement_100_tt
		add_country_modifier = {
			name = escanni_refugee_integration
			duration = -1
		}
	}

	option = {
		name = escanni_refugees_settlement.100.c
		ai_chance = { factor = 1 }
		custom_tooltip = escanni_refugees_settlement_100_tt
		
		trigger = {
			is_year = 1446
		}
		custom_tooltip = escanni_refugees_settlement_100_tt
		add_country_modifier = {
			name = escanni_refugee_tolerance
			duration = -1
		}
	}

	option = {
		name = escanni_refugees_settlement.100.e
		ai_chance = { factor = 1 }
		custom_tooltip = escanni_refugees_settlement_100_tt
		
		trigger = {
			is_year = 1446
		}
		add_treasury = -20

		custom_tooltip = escanni_refugees_settlement_100_tt
		add_country_modifier = {
			name = escanni_refugee_repatriation
			duration = -1
		}
	}
}

country_event = {#Escann Stands
	id = escanni_refugees_settlement.101
	title = "escanni_refugees_settlement.101.t"
	picture = REFUGEES_ESCAPING_eventPicture

	desc = "escanni_refugees_settlement.101.d"
	
	is_triggered_only = yes
	trigger = {
	}

	option = {
		name = escanni_refugees_settlement.101.a
		ai_chance = { factor = 1 }

		add_splendor = 20
		add_country_modifier = {
			name = escanni_end_of_greentide
			duration = 7300
		}
	}
}

country_event = {#The call of home
	id = escanni_refugees_settlement.102
	title = "escanni_refugees_settlement.102.t"
	picture = REFUGEES_ESCAPING_eventPicture
	desc = "escanni_refugees_settlement.102.d"

	trigger = {
		has_global_flag = new_escanni_adventurer_kingdoms
		NOT = {
			has_country_flag = escanni_refugees_left
		}
		calc_true_if = {
			europe = {
				type = all
				OR = {
					region = inner_castanor_region
					region = west_castanor_region
					region = south_castanor_region
					area = cursewood_area
					area = whistlevale_area
				}
				NOT = { #NOR
					is_empty = yes
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
				owner = {
					OR = {
						NOT = { is_migratory_tribe = yes }
						num_of_cities = 2
					}
					NOT = { has_country_modifier = monstrous_nation }
				}
			}
			amount = 4
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		hidden_effect = {
			define_event_targets_escanni_refugees_2_center = yes
			set_country_flag = escanni_refugees_left
		}
	}

	option = { #Try to convince them to stay
		name = escanni_refugees_settlement.102.a

		trigger = {
			has_country_modifier = escanni_refugee_integration
		}
		add_dip_power = -30

		event_target:escanni_center_target_1 = {
			random_list = {
				75 = {
					modifier = {
						factor = 2
						OR = {
							employed_advisor = {
								culture = castellyrian
							}
							employed_advisor = {
								culture = marcher
							}
						}
					}
					modifier = {
						factor = 2
						any_owned_province = {
							OR = {
								has_province_modifier = escanni_jousting_ground
								has_province_modifier = escanni_center_of_learning
							}
						}
					}
					custom_tooltip = escanni_not_migrating_tt
					event_target:escanni_migration_target_1 = {
						clr_province_flag = escanni_migration_target_RC
						clr_province_flag = escanni_migration_target_IC
						clr_province_flag = escanni_migration_target_corinite
						decrease_escanni_refugee_settlement_size = yes #debug					
					}
					event_target:escanni_migration_target_2 = {
						clr_province_flag = escanni_migration_target_RC
						clr_province_flag = escanni_migration_target_IC
						clr_province_flag = escanni_migration_target_corinite
						decrease_escanni_refugee_settlement_size = yes #debug					
					}
				}
				25 = {
					event_target:escanni_center_target_1 = {
						decrease_escanni_refugee_settlement_size = yes
					}
					set_flags_escanni_refugees_1_2 = yes
				}
			}
		}
		if = {
			limit = {
				event_target:escanni_center_target_2 = {
					NOT = { province_id = event_target:escanni_effect_target_1 }
				}
			}
			event_target:escanni_center_target_2 = {
				random_list = {
					75 = {
						modifier = {
							factor = 2
							OR = {
								employed_advisor = {
									culture = castellyrian
								}
								employed_advisor = {
									culture = marcher
								}
							}
						}
						modifier = {
							factor = 2
							any_owned_province = {
								OR = {
									has_province_modifier = escanni_jousting_ground
									has_province_modifier = escanni_center_of_learning
								}
							}
						}
						custom_tooltip = escanni_not_migrating_tt
						event_target:escanni_migration_target_3 = {
							clr_province_flag = escanni_migration_target_RC
							clr_province_flag = escanni_migration_target_IC
							clr_province_flag = escanni_migration_target_corinite
							decrease_escanni_refugee_settlement_size = yes #debug
						}
						event_target:escanni_migration_target_4 = {
							clr_province_flag = escanni_migration_target_RC
							clr_province_flag = escanni_migration_target_IC
							clr_province_flag = escanni_migration_target_corinite
							decrease_escanni_refugee_settlement_size = yes #debug
						}
					}
					25 = {
						event_target:escanni_center_target_2 = {
							decrease_escanni_refugee_settlement_size = yes
						}
						set_flags_escanni_refugees_3_4 = yes
					}
				}
			}
		}
	}

	option = { #Good riddance
		name = escanni_refugees_settlement.102.b
		ai_chance = { factor = 1 }

		event_target:escanni_center_target_1 = {
			decrease_escanni_refugee_settlement_size = yes
			random_list = {
				60 = {
					set_flags_escanni_refugees_1_2 = yes
					custom_tooltip = escanni_refugees_settlement_102_c_tt
				}
				40 = {
					event_target:escanni_migration_target_1 = {
						clr_province_flag = escanni_migration_target_RC
						clr_province_flag = escanni_migration_target_IC
						clr_province_flag = escanni_migration_target_corinite
						decrease_escanni_refugee_settlement_size = yes #debug		
					}
					event_target:escanni_migration_target_2 = {
						clr_province_flag = escanni_migration_target_RC
						clr_province_flag = escanni_migration_target_IC
						clr_province_flag = escanni_migration_target_corinite
						decrease_escanni_refugee_settlement_size = yes #debug		
					}
					custom_tooltip = escanni_refugees_settlement_102_b_tt
				}
			}
		}
		if = {
			limit = {
				event_target:escanni_center_target_2 = {
					NOT = { province_id = event_target:escanni_center_target_1 }
				}
			}
			event_target:escanni_center_target_2 = {
				decrease_escanni_refugee_settlement_size = yes
			}
			random_list = {
				60 = {
					set_flags_escanni_refugees_3_4 = yes
					custom_tooltip = escanni_refugees_settlement_102_c_tt
				}
				40 = {
					event_target:escanni_migration_target_3 = {
						clr_province_flag = escanni_migration_target_RC
						clr_province_flag = escanni_migration_target_IC
						clr_province_flag = escanni_migration_target_corinite
						decrease_escanni_refugee_settlement_size = yes #debug		
					}
					event_target:escanni_migration_target_4 = {
						clr_province_flag = escanni_migration_target_RC
						clr_province_flag = escanni_migration_target_IC
						clr_province_flag = escanni_migration_target_corinite
						decrease_escanni_refugee_settlement_size = yes #debug		
					}
					custom_tooltip = escanni_refugees_settlement_102_b_tt
				}
			}
		}
	}

	option = { #We will provide an escort, to protect their convoy
		name = escanni_refugees_settlement.102.c
		ai_chance = { factor = 1 }

		if = {
			limit = {
				total_development = 200
			}
			add_treasury = -60
		}
		else_if = {
			limit = {
				total_development = 100
			}
			add_treasury = -40
		}
		else = {
			add_treasury = -20
		}
		add_prestige = 5
		
		every_known_country = {
			limit = {
				capital_scope = {
					OR = {
						region = inner_castanor_region
						region = south_castanor_region
						region = west_castanor_region
						area = whistlevale_area
						area = cursewood_area
					}
				}
				NOT = {
					has_country_modifier = monstrous_nation
				}
			}
			add_opinion = {
				who = ROOT
				modifier = escorted_refugees_back
			}
		}

		event_target:escanni_center_target_1 = {
			decrease_escanni_refugee_settlement_size = yes
			custom_tooltip = escanni_refugees_settlement_102_c_tt
			set_flags_escanni_refugees_1_2 = yes
		}
		if = {
			limit = {
				event_target:escanni_center_target_2 = {
					NOT = { province_id = event_target:escanni_center_target_1 }
				}
			}
			event_target:escanni_center_target_2 = {
				decrease_escanni_refugee_settlement_size = yes
			}
			set_flags_escanni_refugees_3_4 = yes
			custom_tooltip = escanni_refugees_settlement_102_c_tt
		}
	}
}

country_event = {#Result of refugee policy
	id = escanni_refugees_settlement.103
	title = "escanni_refugees_settlement.103.t"
	picture = REFUGEES_ESCAPING_eventPicture
	desc = "escanni_refugees_settlement.103.d"
	
	is_triggered_only = yes

	trigger = {
		escanni_refugee_centers = {#Won't trigger if you have lost your center in the meantime
			type = any
			owned_by = ROOT
		}
		calc_true_if = {
			europe = {
				type = all
				OR = {
					region = inner_castanor_region
					region = west_castanor_region
					region = south_castanor_region
					area = cursewood_area
					area = whistlevale_area
				}
				NOT = {
					is_empty = yes
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
				owner = {
					OR = {
						NOT = { is_migratory_tribe = yes }
						num_of_cities = 2
					}
					NOT = { has_country_modifier = monstrous_nation }
				}
			}
			amount = 2
		}
	}

	immediate = {
		hidden_effect = {
			define_event_targets_escanni_refugees_1_center = yes
		}
	}

	option = {#We shall escort them safely to their new home
		name = escanni_refugees_settlement.103.a
		ai_chance = { factor = 1 }
		trigger = {
			OR = {
				has_country_modifier = escanni_refugee_repatriation
				has_country_modifier = escanni_refugee_tolerance
			}
		}
		add_treasury = -30
		add_adm_power = -15
		add_prestige = 10
		event_target:escanni_center_target_1 = {
			decrease_escanni_refugee_settlement_size = yes
		}
		set_flags_escanni_refugees_1_2 = yes
	}
	option = {#They are free to go, but we will not help them
		name = escanni_refugees_settlement.103.b
		ai_chance = { factor = 1 }
		trigger = {
			has_country_modifier = escanni_refugee_repatriation
		}
		add_prestige = -5
		event_target:escanni_center_target_1 = {
			decrease_escanni_refugee_settlement_size = yes
		}
		random_list = {
			60 = {
				set_flags_escanni_refugees_1_2 = yes
				custom_tooltip = escanni_refugees_settlement_102_c_tt
			}
			40 = {
				event_target:escanni_migration_target_1 = {
					clr_province_flag = escanni_migration_target_IC
					clr_province_flag = escanni_migration_target_corinite
					clr_province_flag = escanni_migration_target_RC
					decrease_escanni_refugee_settlement_size = yes #debug
				}
				event_target:escanni_migration_target_2 = {
					clr_province_flag = escanni_migration_target_IC
					clr_province_flag = escanni_migration_target_corinite
					clr_province_flag = escanni_migration_target_RC
					decrease_escanni_refugee_settlement_size = yes #debug
				}
				custom_tooltip = escanni_refugees_settlement_102_b_tt
			}
		}
	}
	option = {#Try to better their situation
		name = escanni_refugees_settlement.103.c
		ai_chance = { factor = 3 }
		trigger = {
			has_country_modifier = escanni_refugee_tolerance
		}
		add_treasury = -45
		add_adm_power = -25
		random_list = {
			20 = {
				event_target:escanni_center_target_1 = {
					decrease_escanni_refugee_settlement_size = yes
				}
				event_target:escanni_effect_target_1 = {
					add_random_development = 1
					add_local_autonomy = 10
				}
				if = {
					limit = {
						event_target:escanni_effect_target_2 = {
							NOT = { province_id = event_target:escanni_effect_target_1 }
						}
					}
					event_target:escanni_effect_target_2 = {
						add_random_development = 1
						add_local_autonomy = 10
					}
				}
				event_target:escanni_migration_target_1 = {
					clr_province_flag = escanni_migration_target_RC
					clr_province_flag = escanni_migration_target_IC
					clr_province_flag = escanni_migration_target_corinite
					decrease_escanni_refugee_settlement_size = yes #debug					
				}
				event_target:escanni_migration_target_2 = {
					clr_province_flag = escanni_migration_target_RC
					clr_province_flag = escanni_migration_target_IC
					clr_province_flag = escanni_migration_target_corinite
					decrease_escanni_refugee_settlement_size = yes #debug				
				}
			}
			20 = {
				set_flags_escanni_refugees_1_2 = yes
			}
			60 = {
				custom_tooltip = escanni_not_migrating_tt
				event_target:escanni_migration_target_1 = {
					clr_province_flag = escanni_migration_target_RC
					clr_province_flag = escanni_migration_target_IC
					clr_province_flag = escanni_migration_target_corinite
					decrease_escanni_refugee_settlement_size = yes #debug				
				}
				event_target:escanni_migration_target_2 = {
					clr_province_flag = escanni_migration_target_RC
					clr_province_flag = escanni_migration_target_IC
					clr_province_flag = escanni_migration_target_corinite
					decrease_escanni_refugee_settlement_size = yes #debug				
				}
			}
		}
	}
	option = {#We welcome our new citizens with open arms
		name = escanni_refugees_settlement.103.e
		ai_chance = { factor = 100 }
		trigger = {
			has_country_modifier = escanni_refugee_integration
		}
		add_treasury = -40
		add_adm_power = -20
		random_list = {
			5 = {
				event_target:escanni_center_target_1 = {
					decrease_escanni_refugee_settlement_size = yes
				}
				event_target:escanni_effect_target_1 = {
					add_random_development = 1
					add_local_autonomy = 10
				}
				if = {
					limit = {
						event_target:escanni_effect_target_2 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_2 = {
						add_random_development = 1
						add_local_autonomy = 10
					}
				}
			}
			5 = {
				custom_tooltip = escanni_not_migrating_tt
			}
		}
		event_target:escanni_migration_target_1 = {
			clr_province_flag = escanni_migration_target_RC
			clr_province_flag = escanni_migration_target_IC
			clr_province_flag = escanni_migration_target_corinite
			decrease_escanni_refugee_settlement_size = yes #debug
		}
		event_target:escanni_migration_target_2 = {
			clr_province_flag = escanni_migration_target_RC
			clr_province_flag = escanni_migration_target_IC
			clr_province_flag = escanni_migration_target_corinite
			decrease_escanni_refugee_settlement_size = yes #debug			
		}
	}
}

#Wescann side 300+
country_event = { #event manager
	id = escanni_refugees_settlement.300
	title = "escanni_refugees_settlement.300.t"
	picture = REFUGEES_ESCAPING_eventPicture
	desc = "escanni_refugees_settlement.300.d"
	
	hidden = yes
	
	is_triggered_only = yes

	trigger = {
		escanni_refugee_centers = {
			type = any
			owned_by = ROOT
		}
		NOT = { has_country_modifier = escanni_timer_mod }
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = escanni_refugees_settlement.300.a
		trigger = {
			OR = {
				NOT = { has_global_flag = new_escanni_adventurer_kingdoms }
				has_country_flag = escanni_refugees_left
			}
		}
		random_list = {
			1 = {
				modifier = {
					factor = 0
					has_country_flag = escanni_refugees_arrived
				}
				country_event = {
					id = escanni_refugees_settlement.100 #setup policy the first time
				}
			}
			100 = {
				modifier = {
					factor = 0
					OR = {
						has_country_flag = escanni_robbers_event
						NOT = { has_country_flag = escanni_refugees_arrived }
						NOT = {
							any_owned_province = {
								has_escanni_refugees = yes
								unrest = 0
							}
						}
					}
				}
				country_event = {
					id = escanni_refugees_settlement.301 #Infamous robbers
				}
			}
			100 = {
				modifier = {
					factor = 0
					OR = {
						has_country_flag = escanni_artisans_event
						NOT = { has_country_flag = escanni_refugees_arrived }
						NOT = { has_country_modifier = escanni_refugee_integration }
					}
				}
				country_event = {
					id = escanni_refugees_settlement.302 #Artisans complain
				}
			}
		}
	}
	option = {
		name = escanni_refugees_settlement.300.b
		trigger = {
			has_global_flag = new_escanni_adventurer_kingdoms
			NOT = { has_country_flag = escanni_refugees_left }
		}
		country_event = {
			id = escanni_refugees_settlement.102 #The call of Home
		}
		set_country_flag = escanni_refugees_left
	}
}
country_event = { #infamous robbers
	id = escanni_refugees_settlement.301
	title = "escanni_refugees_settlement.301.t"
	picture = REFUGEES_ESCAPING_eventPicture
	desc = "escanni_refugees_settlement.301.d"
	
	is_triggered_only = yes

	trigger = {
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_country_flag = escanni_robbers_event
		random_owned_province = {
			limit = { has_escanni_refugees = yes }
			save_event_target_as = escanni_center_target_1
			random_area_province = {
				limit = {
					owned_by = ROOT
				}
				save_event_target_as = escanni_effect_target_1
			}
			random_area_province = {
				limit = { 
					NOT = { province_id = event_target:escanni_effect_target_1 } 
					owned_by = ROOT
				}
				save_event_target_as = escanni_effect_target_2
			}
			random_area_province = {
				limit = { 
					NOT = { province_id = event_target:escanni_effect_target_1 } 
					NOT = { province_id = event_target:escanni_effect_target_2 }
					owned_by = ROOT
				}
				save_event_target_as = escanni_effect_target_3
			}
		}
		hidden_effect = {
			country_event = {
				id = escanni_refugees_settlement.103
				days = 2738
			}
		}
		add_country_modifier = {
			name = escanni_timer_mod
			duration = 5470
			hidden = yes
		}
	}

	option = {
		name = escanni_refugees_settlement.301.a
		ai_chance = {
			factor = 6
		}
		add_country_modifier = {
			name = escanni_soothed_the_masses
			duration = 5475
		}
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -10
		}
		event_target:escanni_effect_target_1 = {
			add_province_modifier = {
				name = upset_escanni_refugees
				duration = 5475
			}
		}
		if = {
			limit = {
				event_target:escanni_effect_target_2 = {
					owned_by = ROOT
				}
			}
			event_target:escanni_effect_target_2 = {
				add_province_modifier = {
					name = upset_escanni_refugees
					duration = 5475
				}
			}
		}
		if = {
			limit = {
				event_target:escanni_effect_target_3 = {
					owned_by = ROOT
				}
			}
			event_target:escanni_effect_target_3 = {
				add_province_modifier = {
					name = upset_escanni_refugees
					duration = 5475
				}
			}
		}
		random_list = {
			95 = {}
			5 = { 
				event_target:escanni_center_target_1 = {
					decrease_escanni_refugee_settlement_size = yes 
				}
			}
		}
		decrease_escanni_integration_policy = yes
	}
	option = {
		name = escanni_refugees_settlement.301.b
		ai_chance = {
			factor = 6
		}
		add_prestige = -10
		add_splendor = -20
		add_treasury = -40
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -10
		}
		add_country_modifier = {
			name = escanni_upset_the_masses
			duration = 5475
		}
		event_target:escanni_effect_target_1 = {
			add_province_modifier = {
				name = appeased_escanni_refugees
				duration = 5475
			}
		}
		if = {
			limit = {
				event_target:escanni_effect_target_2 = {
					owned_by = ROOT
				}
			}
			event_target:escanni_effect_target_2 = {
				add_province_modifier = {
					name = appeased_escanni_refugees
					duration = 5475
				}
			}
		}
		if = {
			limit = {
				event_target:escanni_effect_target_3 = {
					owned_by = ROOT
				}
			}
			event_target:escanni_effect_target_3 = {
				add_province_modifier = {
					name = appeased_escanni_refugees
					duration = 5475
				}
			}
		}
		random_list = {
			95 = {}
			5 = {
				event_target:escanni_center_target_1 = {
					decrease_escanni_refugee_settlement_size = yes
				}
				event_target:escanni_effect_target_1 = {
					add_random_development = 1
				}
				if = {
					limit = {
						event_target:escanni_effect_target_2 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_2 = {
						add_random_development = 1
					}
				}
				if = {
					limit = {
						event_target:escanni_effect_target_3 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_3 = {
						add_random_development = 1
					}
				}
			}
		}
		increase_escanni_integration_policy = yes
	}
	option = {
		name = escanni_refugees_settlement.301.c
		ai_chance = {
			factor = 6
		}
		random_list = {
			60 = {
				add_estate_loyalty = {
					estate = estate_nobles
					loyalty = -10
				}
				add_prestige = -5
				create_general = {
					tradition = 50
					culture = marcher
				}
				event_target:escanni_effect_target_1 = {
					add_province_modifier = {
						name = appeased_escanni_refugees
						duration = 5475
					}
				}
				if = {
					limit = {
						event_target:escanni_effect_target_2 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_2 = {
						add_province_modifier = {
							name = appeased_escanni_refugees
							duration = 5475
						}
					}
				}
				if = {
					limit = {
						event_target:escanni_effect_target_3 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_3 = {
						add_province_modifier = {
							name = appeased_escanni_refugees
							duration = 5475
						}
					}
				}
			}
			35 = {
				add_army_tradition = 5
				add_prestige = 5
				create_general = {
					tradition = 35
					culture = ROOT
				}
				event_target:escanni_effect_target_1 = {
					add_province_modifier = {
						name = upset_escanni_refugees
						duration = 5475
					}
				}
				if = {
					limit = {
						event_target:escanni_effect_target_2 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_2 = {
						add_province_modifier = {
							name = upset_escanni_refugees
							duration = 5475
						}
					}
				}
				if = {
					limit = {
						event_target:escanni_effect_target_3 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_3 = {
						add_province_modifier = {
							name = upset_escanni_refugees
							duration = 5475
						}
					}
				}
			}
			5 = {}
		}
		if = {
			limit = { event_target:escanni_effect_target_1 = { NOT = { has_province_modifier = escanni_jousting_ground }}}
			event_target:escanni_effect_target_1 = { add_province_modifier = { name = escanni_jousting_ground duration = 3600 }}
		}
		else = {
			random_owned_province = { 
				limit = { NOT = { has_province_modifier = escanni_jousting_ground } }
				add_province_modifier = { name = escanni_jousting_ground duration = 3600 }
			}
		}
	}
	option = {
		name = escanni_refugees_settlement.301.e
		ai_chance = {
			factor = 1
		}
		add_treasury = 20
		event_target:escanni_center_target_1 = {
			decrease_escanni_refugee_settlement_size = yes
			if = {
				limit = {
					event_target:escanni_center_target_1 = {
						has_escanni_refugees = yes
					}
				}
				event_target:escanni_effect_target_1 = {
					add_province_modifier = {
						name = escanni_refugee_discriminate_escann
						duration = 5475
					}
				}
				if = {
					limit = {
						event_target:escanni_effect_target_2 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_2 = {
						add_province_modifier = {
							name = escanni_refugee_discriminate_escann
							duration = 5475
						}
					}
				}
				if = {
					limit = {
						event_target:escanni_effect_target_3 = {
							owned_by = ROOT
						}
					}
					event_target:escanni_effect_target_3 = {
						add_province_modifier = {
							name = escanni_refugee_discriminate_escann
							duration = 5475
						}
					}
				}
			}
		}
		random_list = {
			20 = {
				set_flags_escanni_refugees_1_2_no_immediate = yes
				custom_tooltip = escanni_refugees_settlement_102_c_tt
			}
			80 = {
				custom_tooltip = escanni_refugees_settlement_102_b_tt
			}
		}
		decrease_escanni_integration_policy = yes
	}
}
country_event = { #artisans complain NOT REMADE YET
	id = escanni_refugees_settlement.302
	title = "escanni_refugees_settlement.302.t"
	picture = REFUGEES_ESCAPING_eventPicture
	desc = "escanni_refugees_settlement.302.d"
	
	is_triggered_only = yes

	trigger = {
		any_owned_province = {
			has_escanni_refugees = yes
		}
		has_country_modifier = escanni_refugee_integration
		NOT = { has_country_flag = escanni_artisans_event }
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_country_flag = escanni_artisans_event
		every_owned_province = {
			limit = { has_escanni_refugees = yes }
			save_event_target_as = escanni_center_target_1
			random_area_province = {
				limit = {
					owned_by = ROOT
				}
				save_event_target_as = escanni_effect_target_1
			}
			random_area_province = {
				limit = { 
					NOT = { province_id = event_target:escanni_effect_target_1 } 
					owned_by = ROOT
				}
				save_event_target_as = escanni_effect_target_2
			}
			random_area_province = {
				limit = { 
					NOT = { province_id = event_target:escanni_effect_target_1 } 
					NOT = { province_id = event_target:escanni_effect_target_2 }
					owned_by = ROOT
				}
				save_event_target_as = escanni_effect_target_3
			}
		}
		country_event = {
			id = escanni_refugees_settlement.103
			days = 2738
		}
		add_country_modifier = {
			name = escanni_timer_mod
			duration = 5470
			hidden = yes
		}
	}

	option = {
		name = escanni_refugees_settlement.302.a
		ai_chance = {
			factor = 1
		}
		add_estate_loyalty = {
			estate = estate_burghers
			loyalty = -15
		}
		add_country_modifier = {
			name = escanni_unrestp_prodp_statecostn_mod
			duration = 5475
		}
		event_target:escanni_effect_target_1 = {
			add_province_modifier = {
				name = appeased_escanni_refugees
				duration = 5475
			}
		}
		if = {
			limit = {
				event_target:escanni_effect_target_2 = {
					owned_by = ROOT
				}
			}
			event_target:escanni_effect_target_2 = {
				add_province_modifier = {
					name = appeased_escanni_refugees
					duration = 5475
				}
			}
		}
		if = {
			limit = {
				event_target:escanni_effect_target_3 = {
					owned_by = ROOT
				}
			}
			event_target:escanni_effect_target_3 = {
				add_province_modifier = {
					name = appeased_escanni_refugees
					duration = 5475
				}
			}
		}
	}
	option = {
		name = escanni_refugees_settlement.302.b
		ai_chance = {
			factor = 1
		}
		add_estate_loyalty = {
			estate = estate_burghers
			loyalty = 5
		}
		add_country_modifier = {
			name = escanni_unrestn_tradep_mod
			duration = 5475
		}
		decrease_escanni_integration_policy = yes
	}
	option = { #special 1 - greedy/cruel
		name = escanni_refugees_settlement.302.c
		highlight = yes
		trigger = {
			OR = {
				ruler_has_personality = cruel_personality
				ruler_has_personality = greedy_personality
			}
		}
		ai_chance = {
			factor = 6
		}
		add_treasury = 50
		add_prestige = -5
		event_target:escanni_effect_target_1 = {
			add_province_modifier = {
				name = exploited_escanni_refugees
				duration = 5475
			}
		}
		if = {
			limit = {
				event_target:escanni_effect_target_2 = {
					owned_by = ROOT
				}
			}
			event_target:escanni_effect_target_2 = {
				add_province_modifier = {
					name = exploited_escanni_refugees
					duration = 5475
				}
			}
		}
		if = {
			limit = {
				event_target:escanni_effect_target_3 = {
					owned_by = ROOT
				}
			}
			event_target:escanni_effect_target_3 = {
				add_province_modifier = {
					name = exploited_escanni_refugees
					duration = 5475
				}
			}
		}
		decrease_escanni_integration_policy = yes
	}
	option = { #special 2 - esmari or giberd
		name = escanni_refugees_settlement.302.e
		highlight = yes
		trigger = {
			OR = {
				accepted_culture = esmari
				tag = A81
			}
		}
		ai_chance = {
			factor = 6
		}
		add_prestige = 5
		add_country_modifier = {
			name = escanni_unrestn_prodp_mod
			duration = 5475
		}
	}
}

#400+ Events on Escann side
country_event = {#Escanni event manager NOT REMADE YET
	id = escanni_refugees_settlement.400
	title = "escanni_refugees_settlement.400.t"
	picture = REFUGEES_ESCAPING_eventPicture
	desc = "escanni_refugees_settlement.400.d"
	
	hidden = yes
	
	is_triggered_only = yes

	trigger = {
		capital_scope = {
			OR = {
				region = inner_castanor_region
				region = west_castanor_region
				region = south_castanor_region
				area = cursewood_area
				area = whistlevale_area
			}
		}
		#NOT = { has_country_flag = elikhand_no_refugees }
		any_owned_province = {
			OR = {
				has_province_flag = escanni_migration_target_RC
				has_province_flag = escanni_migration_target_IC
				has_province_flag = escanni_migration_target_corinite
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = escanni_refugees_settlement.400.a
		ai_chance = { factor = 1 }
		random_list = {
			100 = {
				modifier = {
					factor = 0
					NOT = { 
						AND = {
							#NOT = { has_country_flag = elikhand_no_refugees }
							any_owned_province = {
								OR = {
									has_province_flag = escanni_migration_target_RC
									has_province_flag = escanni_migration_target_IC
									has_province_flag = escanni_migration_target_corinite
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
							#OR = {
							#	has_country_flag = marrhold_refugees_return
							#	has_country_flag = countsleague_refugees_return
							#	has_country_flag = escanni_refugees_return
							#}
						}
					}
				}
				country_event = {
					id = escanni_refugees_settlement.401
				}
			}
			100 = {
				modifier = {
					factor = 0
					NOT = {
						AND = {
							#NOT = { has_country_flag = elikhand_no_refugees }
							any_owned_province = {
								OR = {
									has_province_flag = escanni_migration_target_RC
									has_province_flag = escanni_migration_target_IC
									has_province_flag = escanni_migration_target_corinite
								}
							}
							OR = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						}
					}
				}
				country_event = {
					id = escanni_refugees_settlement.402
				}
			}
			1 = {}
		}
	}
}
country_event = {#Former inhabitants return home - repeat NOT REMADE YET
	id = escanni_refugees_settlement.401
	title = "escanni_refugees_settlement.401.t"
	picture = REFUGEES_ESCAPING_eventPicture
	desc = "escanni_refugees_settlement.401.d"
	
	is_triggered_only = yes

	trigger = {
		capital_scope = {
			OR = {
				superregion = western_cannor_superregion
				superregion = escann_superregion
			}
		}
		#NOT = { has_country_flag = elikhand_no_refugees }
		any_owned_province = {
			OR = {
				has_province_flag = escanni_migration_target_RC
				has_province_flag = escanni_migration_target_IC
				has_province_flag = escanni_migration_target_corinite
			}
		}
		NOT = {
			OR = {
				has_country_modifier =  orcish_administration
				has_country_modifier =  goblin_administration
			}
		}
		#OR = {
		#	has_country_flag = marrhold_refugees_return
		#	has_country_flag = countsleague_refugees_return
		#	has_country_flag = escanni_refugees_return
		#}
	}

	mean_time_to_happen = {
		days = 1
	}

	option = { #Assimilate them into our society
		name = escanni_refugees_settlement.401.a
		ai_chance = { factor = 1 }
		trigger = {
			NOT = {
				OR = {
					tag = B36 #Marrhold
					tag = B55 #Count's league
				}
			}
		}
		every_owned_province = {
			limit = {
				OR = {
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
			}
			decrease_escanni_refugee_settlement_size = yes #debug
			if = {
				limit = { is_city = yes }
				add_random_development = 1
			}
			else = {
				add_colonysize = 300
			}
			add_province_modifier = {
				name = escanni_refugee_assimilate_escann
				duration = 3650
			}
			if = {
				limit = { NOT = { culture_is_human = yes } }
				add_human_minority_size_effect = yes
			}
			clr_province_flag = escanni_migration_target
		}
	}
	option = { #If they don't adapt, they don't belong
		name = escanni_refugees_settlement.401.b
		ai_chance = { factor = 1 }
		trigger = {
			NOT = {
				OR = {
					tag = B36 #Marrhold
					tag = B55 #Count's league
				}
			}
		}
		random = {
			chance = 10
			add_stability = -1
		}
		every_owned_province = {
			limit = {
				OR = {
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
			}
			decrease_escanni_refugee_settlement_size = yes #debug
			if = {
				limit = {
					ROOT = { 
						any_known_country = {
							capital_scope = {
								OR = {
									superregion = western_cannor_superregion
									superregion = escann_superregion
								}
							}
							#NOT = { has_country_flag = elikhand_no_refugees }
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						} 
					}
				}
				clr_province_flag = escanni_migration_target
				ROOT = {
					random_known_country = {
						limit = {
							capital_scope = {
								OR = {
									superregion = western_cannor_superregion
									superregion = escann_superregion
								}
							}
							#NOT = { has_country_flag = elikhand_no_refugees }
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						}
						random_owned_province = {
							set_province_flag = escanni_migration_target
						}
					}
				}
			}
			else = {
				decrease_escanni_refugee_settlement_size = yes
				if = {
					limit = { is_city = yes }
					add_random_development = 1
				}
				else = {
					add_colonysize = 300
				}
				add_province_modifier = {
					name = escanni_refugee_discriminate_escann
					duration = 3650
				}
				if = {
					limit = { NOT = { culture_is_human = yes } }
					add_human_minority_size_effect = yes
				}
				clr_province_flag = escanni_migration_target
			}
		}
	}
	option = { #It is their lands, and ours
		name = escanni_refugees_settlement.401.c
		ai_chance = { factor = 1 }
		trigger = {
			OR = {
				tag = B36 #Marrhold
				tag = B55 #Count's league
			}
		}
		every_owned_province = {
			limit = {
				OR = {
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
			}
			decrease_escanni_refugee_settlement_size = yes #debug
			if = {
				limit = { is_city = yes }
				add_random_development = 1
			}
			else = {
				add_colonysize = 300
			}
			add_province_modifier = {
				name = escanni_refugee_homecoming_escann
				duration = 3650
			}
			if = {
				limit = { NOT = { culture_is_human = yes } }
				add_human_minority_size_effect = yes
			}
			clr_province_flag = escanni_migration_target
		}
	}
}
country_event = {#Human settlers approach our borders NOT REMADE YET
	id = escanni_refugees_settlement.402
	title = "escanni_refugees_settlement.402.t"
	picture = REFUGEES_ESCAPING_eventPicture
	desc = "escanni_refugees_settlement.402.d"
	
	is_triggered_only = yes

	trigger = {
		capital_scope = {
			OR = {
				superregion = western_cannor_superregion
				superregion = escann_superregion
			}
		}
		#NOT = { has_country_flag = elikhand_no_refugees }
		any_owned_province = {
			OR = {
				has_province_flag = escanni_migration_target_RC
				has_province_flag = escanni_migration_target_IC
				has_province_flag = escanni_migration_target_corinite
			}
		}
		OR = {
			has_country_modifier =  orcish_administration
			has_country_modifier =  goblin_administration
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	option = { #They are those displaced by Korgus, show them mercy, allow them to settle
		name = escanni_refugees_settlement.402.a
		ai_chance = { factor = 1 }
		random = {
			chance = 5
			add_stability = -1
		}
		medium_increase_of_human_tolerance_effect = yes
		if = {
			limit = {
				NOT = { has_country_modifier = monstrous_nation }
			}
			add_dip_power = 30
			add_country_modifier = {
				name = progressive_nation_refugee_escann
				duration = 3650
			}
		}
		else = {
			decrease_monstrous_3 = yes
		}
		every_owned_province = {
			limit = {
				OR = {
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
			}
			clr_province_flag = escanni_migration_target
			random_list = {
				75 = {
					decrease_escanni_refugee_settlement_size = yes #debug
					if = {
						limit = { is_city = yes }
						add_random_development = 1
					}
					else = {
						add_colonysize = 300
					}
					add_province_modifier = {
						name = escanni_refugee_homecoming_escann
						duration = 7300
					}
					if = {
						limit = { NOT = { culture_is_human = yes } }
						add_human_minority_size_effect = yes
					}
					clr_province_flag = escanni_migration_target
				}
				25 = {
					if = {
						limit = {
							ROOT = { 
								any_known_country = {
									capital_scope = {
										OR = {
											superregion = western_cannor_superregion
											superregion = escann_superregion
										}
									}
									#NOT = { has_country_flag = elikhand_no_refugees }
									any_owned_province = {
										NOT = {
											OR = {
												has_province_flag = escanni_migration_target_RC
												has_province_flag = escanni_migration_target_IC
												has_province_flag = escanni_migration_target_corinite
											}
										}
									}
									NOT = {
										OR = {
											has_country_modifier =  orcish_administration
											has_country_modifier =  goblin_administration
										}
									}
								} 
							}
						}
						ROOT = {
							random_known_country = {
								limit = {
									capital_scope = {
										OR = {
											superregion = western_cannor_superregion
											superregion = escann_superregion
										}
									}
									#NOT = { has_country_flag = elikhand_no_refugees }
									any_owned_province = {
										NOT = {
											OR = {
												has_province_flag = escanni_migration_target_RC
												has_province_flag = escanni_migration_target_IC
												has_province_flag = escanni_migration_target_corinite
											}
										}
									}
									NOT = {
										OR = {
											has_country_modifier =  orcish_administration
											has_country_modifier =  goblin_administration
										}
									}
								}
								random_owned_province = {
									set_province_flag = escanni_migration_target
								}
							}
						}
					}
				}
			}
		}
	}

	option = { #Send them away safely, we don't kill on sight
		name = escanni_refugees_settlement.402.b
		ai_chance = { factor = 0 }
		add_treasury = -25
		add_dip_power = -20
		small_increase_of_human_tolerance_effect = yes
		if = {
			limit = {
				NOT = { has_country_modifier = monstrous_nation }
			}
			add_country_modifier = {
				name = nice_people_with_refugee_escann
				duration = 3650
			}
		}
		else = {
			decrease_monstrous_1 = yes
		}
		every_owned_province = {
			limit = {
				OR = {
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
			}
			if = {
				limit = {
					ROOT = { 
						any_known_country = {
							capital_scope = {
								OR = {
									superregion = western_cannor_superregion
									superregion = escann_superregion
								}
							}
							#NOT = { has_country_flag = elikhand_no_refugees }
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						} 
					}
				}
				ROOT = {
					random_known_country = {
						limit = {
							capital_scope = {
								OR = {
									superregion = western_cannor_superregion
									superregion = escann_superregion
								}
							}
							#NOT = { has_country_flag = elikhand_no_refugees }
							any_owned_province = {
								NOT = {
									OR = {
										has_province_flag = escanni_migration_target_RC
										has_province_flag = escanni_migration_target_IC
										has_province_flag = escanni_migration_target_corinite
									}
								}
							}
							NOT = {
								has_country_modifier =  orcish_administration
								has_country_modifier =  goblin_administration
							}
						}
						random_owned_province = {
							set_province_flag = escanni_migration_target
						}
					}
				}
				clr_province_flag = escanni_migration_target
			}
			else = {
				decrease_escanni_refugee_settlement_size = yes #debug
				if = {
					limit = { is_city = yes }
					add_random_development = 1
				}
				else = {
					add_colonysize = 300
				}
				if = {
					limit = { NOT = { culture_is_human = yes } }
					add_human_minority_size_effect = yes
				}
				clr_province_flag = escanni_migration_target
			}
		}
	}

	option = { #They can stay, but whatever they brought is our now
		name = escanni_refugees_settlement.402.c
		ai_chance = { factor = 0 }
		add_treasury = 10
		add_dip_power = 10
		small_decrease_of_human_tolerance_effect = yes
		if = {
			limit = {
				NOT = { has_country_modifier = monstrous_nation }
			}
			add_prestige = -5
		}
		else = {
			increase_monstrous_1 = yes
		}
		every_owned_province = {
			limit = {
				OR = {
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
			}
			clr_province_flag = escanni_migration_target
			random_list = {
				25 = {
					decrease_escanni_refugee_settlement_size = yes #debug
					if = {
						limit = { is_city = yes }
						add_random_development = 1
					}
					else = {
						add_colonysize = 300
					}
					add_province_modifier = {
						name = escanni_refugee_discriminate_escann
						duration = 7300
					}
					if = {
						limit = { NOT = { culture_is_human = yes } }
						add_human_minority_size_effect = yes
					}
					clr_province_flag = escanni_migration_target
				}
				75 = {
					if = {
						limit = {
							ROOT = { 
								any_known_country = {
									capital_scope = {
										OR = {
											superregion = western_cannor_superregion
											superregion = escann_superregion
										}
									}
									#NOT = { has_country_flag = elikhand_no_refugees }
									any_owned_province = {
										NOT = {
											OR = {
												has_province_flag = escanni_migration_target_RC
												has_province_flag = escanni_migration_target_IC
												has_province_flag = escanni_migration_target_corinite
											}
										}
									}
									NOT = {
										OR = {
											has_country_modifier =  orcish_administration
											has_country_modifier =  goblin_administration
										}
									}
								} 
							}
						}
						ROOT = {
							random_known_country = {
								limit = {
									capital_scope = {
										OR = {
											superregion = western_cannor_superregion
											superregion = escann_superregion
										}
									}
									#NOT = { has_country_flag = elikhand_no_refugees }
									any_owned_province = {
										NOT = {
											OR = {
												has_province_flag = escanni_migration_target_RC
												has_province_flag = escanni_migration_target_IC
												has_province_flag = escanni_migration_target_corinite
											}
										}
									}
									NOT = {
										OR = {
											has_country_modifier =  orcish_administration
											has_country_modifier =  goblin_administration
										}
									}
								}
								random_owned_province = {
									set_province_flag = escanni_migration_target
								}
							}
						}
					}
				}
			}
		}
	}

	option = { #They cannot stay, make them leave
		name = escanni_refugees_settlement.402.e
		ai_chance = { factor = 0 }
		add_mil_power = -10
		random = {
			chance = 10
			add_stability = 1
		}
		medium_decrease_of_human_tolerance_effect = yes
		if = {
			limit = {
				NOT = { has_country_modifier = monstrous_nation }
			}
			add_dip_power = -10
		}
		else = {
			increase_monstrous_3 = yes
		}
		every_owned_province = {
			limit = {
				OR = {
					has_province_flag = escanni_migration_target_RC
					has_province_flag = escanni_migration_target_IC
					has_province_flag = escanni_migration_target_corinite
				}
			}
			clr_province_flag = escanni_migration_target
			random_list = {
				25 = {
					decrease_escanni_refugee_settlement_size = yes #debug
					if = {
						limit = { is_city = yes }
						add_random_development = 1
					}
					else = {
						add_colonysize = 300
					}
					add_province_modifier = {
						name = escanni_refugee_discriminate_escann
						duration = 7300
					}
					if = {
						limit = { NOT = { culture_is_human = yes } }
						add_human_minority_size_effect = yes
					}
					clr_province_flag = escanni_migration_target
				}
				75 = {
					if = {
						limit = {
							ROOT = { 
								any_known_country = {
									capital_scope = {
										OR = {
											superregion = western_cannor_superregion
											superregion = escann_superregion
										}
									}
									#NOT = { has_country_flag = elikhand_no_refugees }
									any_owned_province = {
										NOT = {
											OR = {
												has_province_flag = escanni_migration_target_RC
												has_province_flag = escanni_migration_target_IC
												has_province_flag = escanni_migration_target_corinite
											}
										}
									}
									NOT = {
										OR = {
											has_country_modifier =  orcish_administration
											has_country_modifier =  goblin_administration
										}
									}
								} 
							}
						}
						ROOT = {
							random_known_country = {
								limit = {
									capital_scope = {
										OR = {
											superregion = western_cannor_superregion
											superregion = escann_superregion
										}
									}
									#NOT = { has_country_flag = elikhand_no_refugees }
									any_owned_province = {
										NOT = {
											OR = {
												has_province_flag = escanni_migration_target_RC
												has_province_flag = escanni_migration_target_IC
												has_province_flag = escanni_migration_target_corinite
											}
										}
									}
									NOT = {
										OR = {
											has_country_modifier =  orcish_administration
											has_country_modifier =  goblin_administration
										}
									}
								}
								random_owned_province = {
									set_province_flag = escanni_migration_target
								}
							}
						}
					}
				}
			}
		}
	}
}