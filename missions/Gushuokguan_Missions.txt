gushuokguan_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_1_2 = {
		icon = mission_a_million_rice_fields
		position = 2
		required_missions = { gushuokguan_2_1 } 
		provinces_to_highlight = {  } 

		trigger = {
			num_of_owned_provinces_with = {
				OR = {
					OR = {
						has_building = workshop
						has_building = counting_house
					}
					is_prosperous = yes
					development = 8
				}
				value = 15
			}
		}

		effect = {  
			add_country_modifier = {
				name = gushuokguan_economic_buff
				duration = 7300
			}
			custom_tooltip = gushuokguan_immigration_events_tt
			random_list = {
				1 = { country_event = { id = gushuokguan_event.11 } } #Migrants come to X
				1 = { country_event = { id = gushuokguan_event.12 } } #Migrant Clash in X
				1 = { country_event = { id = gushuokguan_event.13 } } #Migrants Clash with Locals
				1 = { country_event = { id = gushuokguan_event.14 } } #Migrants Thrive
				1 = { country_event = { id = gushuokguan_event.15 } } #Stronger Together
				1 = { country_event = { id = gushuokguan_event.16 } } #Migratory Mercenaries
			}
		} 
	}

	gushuokguan_1_3 = {
		icon = mission_son_own_develop_clothes_and_salt
		position = 3
		required_missions = { gushuokguan_1_2 } 
		provinces_to_highlight = {  } 

		trigger = {
			num_of_owned_provinces_with = {
				OR = {
					trade_goods = grain
					trade_goods = livestock
					trade_goods = fish
				}
				has_production_building_trigger = yes
				has_manpower_building_trigger = yes
				has_manufactory_trigger = yes
				base_production = 7
				value = 15
			}
		}

		effect = {  
			for = {
				#custom_tooltip = gushuokguan_smth_tt
				amount = 5
				effect = "
					random_owned_province = {
						limit = {
							OR = {
								trade_goods = grain
								trade_goods = livestock
								trade_goods = fish
							}
							has_production_building_trigger = yes
							has_manpower_building_trigger = yes
							has_manufactory_trigger = yes
							base_production = 7
						}
						add_base_production = 1
						if = { limit = { has_building = training_fields } add_mil_power = 100 }
						else = { remove_building = barracks add_building = training_fields }
					}
				"
			}
			every_owned_province = {
				limit = {
					OR = {
						trade_goods = grain
						trade_goods = livestock
						trade_goods = fish
					}
					has_production_building_trigger = yes
					has_manpower_building_trigger = yes
					has_manufactory_trigger = yes
					base_production = 7
				}
				add_province_modifier = {
					name = gushuokguan_local_supplier
					duration = 18250
				}
			}
		}
	}

	gushuokguan_1_4 = {
		icon = mission_sunset
		position = 4
		required_missions = { gushuokguan_1_3 } 
		provinces_to_highlight = {
			superregion = yanshen_superregion
			NOT = { country_or_non_sovereign_subject_holds = ROOT } #Gushuokguan
			devastation = 0.01
			unrest = 0
			AND = {
				OR = {
					province_group = golden_highway_upper_yanshen
					province_group = golden_highway_yanshen_coast
				}
				NOT = {
					development = 12
				}
			}
		} 

		trigger = {  
			yanshen_superregion = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
			}
			all_owned_province = {
				superregion = yanshen_superregion
				NOT = { devastation = 0.01 }
				NOT = { unrest = 0 }
			}
			golden_highway_upper_yanshen = {
				type = all
				development = 12
			}
			golden_highway_yanshen_coast = {
				type = all
				development = 12
			}
		} 

		effect = {  
			add_country_modifier = {
				name = gushuokguan_peace_in_our_time
				duration = -1
			}
		} 
	}

	gushuokguan_1_6 = {
		icon = mission_oirat #False error
		position = 6
		required_missions = { gushuokguan_2_5 } 
		provinces_to_highlight = {  } 

		trigger = { 
			Y96 = { #Guwaamud
				num_of_owned_provinces_with = {
					culture = shuvuush
					NOT = { unrest = 0 }
					province_has_current_tech_fort_trigger = yes
					has_manpower_building_trigger = yes
					value = 5
				}
				custom_trigger_tooltip = {
					tooltip = gushuokguan_1_6_tt
					capital_scope = {
						ROOT = {
							PREV = {
								cavalry_in_province = 20
							}
						}
					}
				}
			}
		} 

		effect = {  
			Y96 = {
				capital_scope = {
					kill_units = {
						who = ROOT
						type = cavalry
						amount = 20
					}
				}
			}
			custom_tooltip = gushuokguan_rock_raiders_tt
			hidden_effect = {
				set_country_flag = gushuokguan_rock_raiders
			}
		} 
	}

	gushuokguan_1_7 = {
		icon = mission_underground_cave
		position = 7
		required_missions = { gushuokguan_1_6 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_rock_raiders_battle_tt
				has_country_flag = gushuokguan_rock_raiders_battle
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_rock_raiders_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_rock_raiders }
				disband_mercenary_company = yes
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_rock_raiders
				set_country_flag = gushuokguan_rock_raiders_tier_2
			}
		} 
	}

	gushuokguan_1_8 = {
		icon = mission_asian_cannon
		position = 8
		required_missions = {
			gushuokguan_2_7
		}
		provinces_to_highlight = {  } 

		trigger = {  
			4901 = { #Hubao
				country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
				infantry_in_province = 10
				artillery_in_province = 10
			}
			Y03 = { #Hubao
				NOT = { liberty_desire = 1 }
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_4_stone_army_challenges_tt
				calc_true_if = {
					mission_completed = gushuokguan_1_7
					mission_completed = gushuokguan_2_9
					mission_completed = gushuokguan_3_7
					mission_completed = gushuokguan_3_9
					mission_completed = gushuokguan_4_7
					mission_completed = gushuokguan_4_9
					amount = 4
				}
			}
		} 

		effect = {  
			4901 = {
				kill_units = {
					who = ROOT
					type = infantry
					amount = 10
				}
				kill_units = {
					who = ROOT
					type = artillery
					amount = 10
				}
			}
			custom_tooltip = gushuokguan_dacite_dragons_tt
			hidden_effect = {
				set_country_flag = gushuokguan_dacite_dragons
				set_variable = {
					which = gushuokguan_dacite_dragons_death_toll
					which = 0
				}
			}
		} 
	}

	gushuokguan_1_9 = {
		icon = mission_necromancy
		position = 9
		required_missions = { gushuokguan_1_8 } 
		provinces_to_highlight = {  } 

		trigger = {  
			OR = {
				custom_trigger_tooltip = {
					tooltip = gushuokguan_renting_to_rending_tt
					AND = { 
						has_global_flag = rending_active
						any_known_country = {
							OR = {
								has_country_flag = rending_ward_flag
								has_country_flag = rending_appease_flag
							}
							ROOT = { is_renting_condottieri_to = PREV } #Gushuokguan
						}
					}
				}
				custom_trigger_tooltip = {
					tooltip = gushuokguan_defeated_spirit_rebels_tt
					check_variable = {
						which = gushuokguan_dacite_dragons_death_toll
						value = 20000
					}
				}
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_dacite_dragons_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_dacite_dragons }
				disband_mercenary_company = yes
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_dacite_dragons
				set_country_flag = gushuokguan_dacite_dragons_tier_2
			}
		} 
	}
}
gushuokguan_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_2_1 = {
		icon = mission_japanese_fort
		position = 1
		provinces_to_highlight = {  } 

		trigger = {
			num_of_owned_provinces_with = {
				OR = {
					has_fort_building_trigger = yes
					has_influencing_fort = yes
				}
				has_production_building_trigger = yes
				value = 10
			}
		}

		effect = {
			define_advisor = {
				type = fortification_expert
				skill = 3
				cost_multiplier = 0.25
			}
			custom_tooltip = gushuokguan_stone_forts_tt
			hidden_effect = {
				every_owned_province = {
					limit = { has_fort_building_trigger = yes } 
					add_province_modifier = {
						name = "gushuokguan_stone_forts"
						duration = -1
					}
				}
			}
		}
	}

	gushuokguan_2_2 = {
		icon = jap_financial_cliques
		position = 2
		required_missions = { gushuokguan_2_1 } 
		provinces_to_highlight = {  } 

		trigger = {
			custom_trigger_tooltip = {
				tooltip = gushuokguan_condottieri_stone_army_tt
				any_known_country = {
					ROOT = { is_renting_condottieri_to = PREV } #Gushuokguan
					any_hired_mercenary_company = {
						template = merc_stone_army #I hope there was another way to check army name
					}
				}
			}
			capital_scope = {
				base_manpower = 5
				has_manpower_building_trigger = yes
			}
		} 

		effect = {  
			country_event = {
				id = gushuokguan_event.3 #The Stone Swords
			}
			custom_tooltip = gushuokguan_stone_army_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_stone_army } 
				disband_mercenary_company = THIS	   #Hopefully this doesn't cause a condottieri-related bug
			}
			hidden_effect = { set_country_flag = gushuokguan_stone_army_tier_2 } 
		} 
	}

	gushuokguan_2_3 = {
		icon = mng_thirteen_provinces
		position = 3
		required_missions = { gushuokguan_2_2 } 
		provinces_to_highlight = {  } 

		trigger = {
			num_of_owned_provinces_with = {
				has_manpower_building_trigger = yes
				has_forcelimit_building_trigger = yes
				value = 10
			}
		}

		effect = {  
			for = {
				amount = 10
				effect = "
					random_owned_province = {
						limit = {
							has_manpower_building_trigger = yes
							has_forcelimit_building_trigger = yes
						}
						add_province_modifier = {
							name = gushuokguan_2_3_modifier
							duration = -1
						}
					}
				"
			}
			custom_tooltip = gushuokguan_can_replenish_mercenaries_tt
			hidden_effect = { set_country_flag = gushuokguan_can_replenish_mercenaries } 
		}
	}

	gushuokguan_2_4 = {
		icon = mjz_for_the_horde
		position = 4
		required_missions = {
			gushuokguan_2_3
			gushuokguan_4_3
		}
		provinces_to_highlight = {  } 

		trigger = {  
			has_mil_advisor_3 = yes
			num_of_generals = 3
			num_of_regiments_at_full_drill = 20
			army_professionalism = 60
			diplomatic_reputation = 3
		} 

		effect = {  
			add_country_modifier = {
				name = gushuokguan_experts_of_warfare
				duration = -1
			}
		} 
	}

	gushuokguan_2_5 = {
		icon = spa_tercios_system
		position = 5
		required_missions = {
			gushuokguan_1_4
			gushuokguan_2_4
		}
		provinces_to_highlight = {  } 

		trigger = {  
			num_of_mercenaries = 30
			calc_true_if = {
				any_known_country = {
					OR = {
						has_opinion = {
							who = ROOT #Gushuokguan
							value = 150
						}
						alliance_with = ROOT #Gushuokguan
						has_spy_network_from = {
							who = ROOT #Gushuokguan
							value = 50
						}
					}
				}
				amount = 3
			}
		} 

		effect = {  
			add_country_modifier = {
				name = gushuokguan_influx_of_foreign_men
				duration = 14600
			}
		} 
	}

	gushuokguan_2_7 = {
		icon = expand_the_swiss_guard
		position = 7
		required_missions = { gushuokguan_2_5 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_rented_condottieri_10_times_tt
				check_variable = {
					which = gushuokguan_rented_condottieri_counter
					value = 10
				}
			}
		}

		effect = {  
			add_years_of_income = 5
			set_country_flag = anb_cant_be_sacked
		}
	}

	gushuokguan_2_8 = {
		icon = mission_alone_in_the_forest_2
		position = 8
		required_missions = { gushuokguan_2_7 } 
		provinces_to_highlight = {  } 

		trigger = {  
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				has_terrain = jungle
				has_manpower_building_trigger = yes
				NOT = { devastation = 0.01 }
				value = 4
			}
			Y96 = { NOT = { liberty_desire = 10 } }
			#has_estate_privilege = the_what #Yea, the what?
			4838 = { #Wongpou
				infantry_in_province = 20
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_4_stone_army_challenges_tt
				calc_true_if = {
					mission_completed = gushuokguan_1_7
					mission_completed = gushuokguan_1_9
					mission_completed = gushuokguan_3_7
					mission_completed = gushuokguan_3_9
					mission_completed = gushuokguan_4_7
					mission_completed = gushuokguan_4_9
					amount = 4
				}
			}
		} 

		effect = {
			4838 = {
				kill_units = {
					who = ROOT #Gushuokguan
					type = cavalry
					amount = 20
				}
			}
			custom_tooltip = gushuokguan_whetstones_tt
			hidden_effect = {
				set_country_flag = gushuokguan_whetstones
			}
		}
	}

	gushuokguan_2_9 = {
		icon = mission_jungle #False error
		position = 9
		required_missions = { gushuokguan_2_8 } 
		provinces_to_highlight = {  } 

		trigger = {  
			any_known_country = {
				num_of_owned_provinces_with = {
					has_terrain = jungle
					value = 3
				}
				OR = {
					ROOT = { is_renting_condottieri_to = PREV } #Gushuokguan
					is_in_war = {
						attacker_leader = ROOT #Gushuokguan
					}
				}
				
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_whetstones_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_whetstones }
				disband_mercenary_company = yes
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_whetstones
				set_country_flag = gushuokguan_whetstones_tier_2
			}
		}
	}
}
gushuokguan_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_3_1 = {
		icon = mission_the_chola_campaigns
		position = 1
		provinces_to_highlight = {  } 

		trigger = {  
			OR = {
				Y05 = { #Lanjinhui
					alliance_with = ROOT #Gushuokguan
					has_opinion = {
						who = ROOT #Gushuokguan
						value = 150
					}
				}
				AND = {
					Y05 = { #Lanjinhui
						has_90_opinion_improved_relation = { target = ROOT } #Gushuokguan
					}
					diplomatic_reputation = 2
					has_dip_advisor = yes
				}
				AND = {
					Y05 = { #Lanjinhui
						is_rival = ROOT
						has_been_insulted_by_root = yes
					}
				}
			}
		} 

		effect = {  
			#Case 1:
			custom_tooltip = gushuokguan_lanjinhui_is_ally_tt
			country_event = {
				id = gushuokguan_event.1 #An Alliance of Convenience
			}
			
			custom_tooltip = feitenEmpty
			
			#Case 2:
			custom_tooltip = gushuokguan_lanjinhui_is_rival_tt
			country_event = {
				id = gushuokguan_event.2 #The Fools of Lanjinhui
			}
			Y05 = { #Lanjinhui
				every_owned_province = {
					add_permanent_claim = ROOT #Gushuokguan
				}
			}
		}
	}

	gushuokguan_3_2 = {
		icon = mission_confrontation
		position = 2
		required_missions = { gushuokguan_3_1 } 
		provinces_to_highlight = {  
			OR = {
				area = liuminxiang_area
				area = erluxi_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT } #Gushuokguan
			#Maybe I'll do other cases later, who knows			
		} 

		trigger = {  
			OR = {
				#Case 1: Ally or vassal
				AND = {
					variable_arithmetic_trigger = {
						custom_tooltip = gushuokguan_larger_than_half_lanjinhui_tt
						export_to_variable = {
							which = lanjinhui_half_army_size
							value = trigger_value:army_size
							who = Y05 #Lanjinhui
						}
						export_to_variable = {
							which = gushuokguan_army_size
							value = trigger_value:army_size
							who = ROOT #Gushuokguan
						}
						multiply_variable = { which = lanjinhui_half_army_size value = 0.5 }
						
						check_variable = { which = gushuokguan_army_size which = lanjinhui_half_army_size }
					}
					Y05 = { #Lanjinhui
						custom_trigger_tooltip = {
							tooltip = gushuokguan_3_2_tt
							capital_scope = {
								ROOT = {
									PREV = {
										infantry_in_province = 6
									}
								}
							}
						}
						has_spy_network_from = {
							who = ROOT
							value = 30
						}
						OR = {
							alliance_with = ROOT #Gushuokguan
							vassal_of = ROOT #Gushuokguan
						}
						
					}
				}
				
				#Case 2: Rival
				AND = {
					is_enemy = Y05 #Lanjinhui
					Y05 = { #Lanjinhui
						has_spy_network_from = {
							who = ROOT
							value = 80
						}
						any_neighbor_province = {
							owned_by = ROOT #Gushuokguan
							infantry_in_province = 6
						}
						
					}
				}
				
				#Case 3: None above
				AND = {
					NOT = { exists = Y05 } #Lanjinhui
					liuminxiang_area = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
					}
					erluxi_area = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
					}
				}
			}
		} 

		effect = {
			if = {
				limit = { Y05 = { alliance_with = ROOT }  } 
				country_event = { id = gushuokguan_event.4 } 
					}
			else_if = {
				limit = {
					Y05 = { #Lanjinhui
						vassal_of = ROOT #Gushuokguan
					}
				}
				Y05 = {
					add_country_modifier = {
						name = gushuokguan_brothers_in_freedom
						duration = 7300
					}
				}
			}
			else_if = {
				limit = {
					Y05 = { #Lanjinhui
						is_enemy = ROOT #Gushuokguan
					}
				}
			custom_tooltip = gushuokguan_incoming_war_tt
				country_event = { id = gushuokguan_event.5 } 
			}
			else_if = {
				limit = {
					liuminxiang_area = { country_or_non_sovereign_subject_holds = ROOT }
					erluxi_area = { country_or_non_sovereign_subject_holds = ROOT }
				}
				release = Y05 #Lanjinhui
				create_subject = {
					subject_type = dao
					subject = Y05 #Lanjinhui
				}
				add_adm_power = 100
			}
		} 
	}

	gushuokguan_3_4 = {
		icon = mng_jing_hang_grand_canal
		position = 4
		required_missions = { gushuokguan_4_3 } 
		provinces_to_highlight = {  } 

		trigger = {
			custom_trigger_tooltip = {
				tooltip = gushuokguan_3_4_trigger_tt
				linyuan_area = {
					type = all
					is_core = ROOT
					owned_by = ROOT
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					if = { 
						limit = { ROOT = { has_parliament = yes } } 
						has_seat_in_parliament = yes 
					}
				}
				yanzhong_area = {
					type = all
					is_core = ROOT
					owned_by = ROOT
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					if = { 
						limit = { ROOT = { has_parliament = yes } } 
						has_seat_in_parliament = yes 
					}
				}
				anjiang_area = {
					type = all
					is_core = ROOT
					owned_by = ROOT
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					if = { 
						limit = { ROOT = { has_parliament = yes } } 
						has_seat_in_parliament = yes 
					}
				}
				tianszi_area = {
					type = all
					is_core = ROOT
					owned_by = ROOT
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					if = { 
						limit = { ROOT = { has_parliament = yes } } 
						has_seat_in_parliament = yes 
					}
				}
				4850 = { #Hunxiang
					is_core = ROOT
					owned_by = ROOT
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					if = { 
						limit = { ROOT = { has_parliament = yes } } 
						has_seat_in_parliament = yes 
					}
				}
				4892 = { #Lamcue
					is_core = ROOT
					owned_by = ROOT
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					if = { 
						limit = { ROOT = { has_parliament = yes } } 
						has_seat_in_parliament = yes 
					}
				}
			}
		}

		effect = {
			release = Y10 #Yingzhen
			create_subject = {
				subject_type = dao
				subject = Y10 #Yingzhen
			} 
			every_owned_province = {
				limit = {
					OR = {
						area = yanzhong_area
						area = balrijin_area
						area = tianszi_area
						area = anjiang_area
						area = linyuan_area
					}
				}
				cede_province = Y10 #Yingzhen
				add_core = Y10 #Yingzhen
			}
			add_mil_power = 50
			add_country_modifier = {
				name = gushuokguan_trade_power_of_the_yan
				duration = 7300
			}
			custom_tooltip = gushuokguan_can_release_hubao_tt
			hidden_effect = { set_country_flag = gushuokguan_can_release_hubao } 
		}
	}

	gushuokguan_3_6 = {
		icon = mission_harimar
		position = 6
		required_missions = { gushuokguan_2_5 } 
		provinces_to_highlight = {  } 

		trigger = {  
			high_tolerance_harimari_race_trigger = yes
			accepted_culture = serene_harimari
			4925 = { #Jiantsiang
				infantry_in_province = 20
				NOT = { unrest = 0 }
				has_tax_building_trigger = yes
				has_production_building_trigger = yes
			}
		} 

		effect = { 
			4925 = {
				kill_units = {
					who = ROOT
					type = infantry
					amount = 20
				}
			} 
			custom_tooltip = gushuokguan_chrome_claws_tt
			hidden_effect = {
				set_country_flag = gushuokguan_chrome_claws
			}
		}
	}

	gushuokguan_3_7 = {
		icon = mission_conquer_bengal_dlh
		position = 7
		required_missions = { gushuokguan_3_6 } 
		provinces_to_highlight = {  } 

		trigger = {  
			any_known_country = {
				ROOT = { is_renting_condottieri_to = PREV } #Gushuokguan
				culture_is_harimari = yes
				has_opinion = {
					who = ROOT
					value = 150
				}
				trust = {
					who = ROOT
					value = 80
				}
			}
		} 

		effect = {
			4914 = { add_harimari_minority_size_effect = yes } #Gushibi
			custom_tooltip = gushuokguan_chrome_claws_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_chrome_claws }
				disband_mercenary_company = yes
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_chrome_claws
				set_country_flag = gushuokguan_chrome_claws_tier_2
			}
		}
	}

	gushuokguan_3_8 = {
		icon = qng_modernize_the_banners
		position = 8
		required_missions = { gushuokguan_2_7 } 
		provinces_to_highlight = {  } 

		trigger = {  
			Y10 = { #Yingzhen
				vassal_of = ROOT
				NOT = { liberty_desire = 0 }
			}
			4853 = { #Anjiang
				cavalry_in_province = 20
				has_production_building_trigger = yes
				has_manpower_building_trigger = yes
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_2_stone_army_challenges_tt
				calc_true_if = {
					mission_completed = gushuokguan_1_7
					mission_completed = gushuokguan_1_9
					mission_completed = gushuokguan_2_9
					mission_completed = gushuokguan_3_7
					mission_completed = gushuokguan_4_7
					mission_completed = gushuokguan_4_9
					amount = 2
				}
			}
		} 

		effect = {  
			4853 = { #Anjiang
				kill_units = {
					who = ROOT
					type = infantry
					amount = 10
				}
			}
			custom_tooltip = gushuokguan_marble_mounts_tt
			hidden_effect = {
				set_country_flag = gushuokguan_marble_mounts
			}
		} 
	}

	gushuokguan_3_9 = {
		icon = mission_war_chest
		position = 9
		required_missions = { gushuokguan_3_8 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_won_100_battles_tt
				check_variable = {
					which = gushuokguan_battle_counter
					value = 100
				}
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_marble_mounts_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_marble_mounts }
				disband_mercenary_company = yes
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_marble_mounts
				set_country_flag = gushuokguan_marble_mounts_tier_2
			}
		}
	}
}
gushuokguan_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_4_1 = {
		icon = mission_scholar_officials
		position = 1
		provinces_to_highlight = {  } 

		trigger = {
			estate_loyalty = {
				estate = estate_eunuchs
				loyalty = 60
			}
			estate_loyalty = {
				estate = estate_adventurers
				loyalty = 60
			}
			estate_loyalty = {
				estate = estate_burghers
				loyalty = 60
			}
			estate_influence = {
				estate = estate_eunuchs
				influence = 50
			}
			estate_influence = {
				estate = estate_adventurers
				influence = 50
			}
			estate_influence = {
				estate = estate_burghers
				influence = 50
			}
		}

		effect = {  
			add_country_modifier = {
				name = gushuokguan_writing_a_new_oath
				duration = 1825
			}
			hidden_effect = {
				country_event = {
					id = gushuokguan_event.6 #The Triple Alliance
				}
			}
		} 
	}

	gushuokguan_4_2 = {
		icon = per_build_the_fire_temples
		position = 2
		required_missions = {
			gushuokguan_4_1
			gushuokguan_5_1
		}
		provinces_to_highlight = {  
			OR = {
				#Case 1: Gushuokguan Core
				AND = {
					OR = {
						area = xuanbing_area
						province_id = 4927 #Shiying
						province_id = 4917 #Jiangchang
						province_id = 4980 #Tsianjian
					}
					NOT = { 
						AND = { 
							is_core = ROOT #Gushuokguan
							OR = {
								has_production_building_trigger = yes
								has_tax_building_trigger = yes
							}
						}
					}
				}
				#Case 2: Zhiqian exists
				owned_by = Y14 #Zhiqian
			}
		} 

		trigger = { 
			NOT = { exists = Y14 } #Zhiqian 
			xuanbing_area = {
				type = all
				is_core = ROOT #Gushuokguan
				OR = {
					has_production_building_trigger = yes
					has_tax_building_trigger = yes
				}
			}
			4927 = { #Shiying
				is_core = ROOT #Gushuokguan
				OR = {
					has_production_building_trigger = yes
					has_tax_building_trigger = yes
				}
			}
			4917 = { #Jiangchang
				is_core = ROOT #Gushuokguan
				OR = {
					has_production_building_trigger = yes
					has_tax_building_trigger = yes
				}
			}
			4980 = { #Tsianjian
				is_core = ROOT #Gushuokguan
				OR = {
					has_production_building_trigger = yes
					has_tax_building_trigger = yes
				}
			}
			estate_loyalty = {
				estate = estate_burghers
				loyalty = 60
			}
			
		} 

		effect = {  
			jiantsiang_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			tianlou_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			jinjiang_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			yiguan_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			xuanbing_area = {
				add_province_modifier = {
					name = gushuokguan_liberation_of_our_kin
					duration = 3650
				}
			}
			4927 = { #Shiying
				add_province_modifier = {
					name = gushuokguan_liberation_of_our_kin
					duration = 3650
				}
			}
			4917 = { #Jiangchang
				add_province_modifier = {
					name = gushuokguan_liberation_of_our_kin
					duration = 3650
				}
			}
			4980 = { #Tsianjian
				add_province_modifier = {
					name = gushuokguan_liberation_of_our_kin
					duration = 3650
				}
			}
		}
	}

	gushuokguan_4_3 = {
		icon = mng_deal_kama_kagyu
		position = 3
		required_missions = {
			gushuokguan_3_2
			gushuokguan_4_2
		}
		provinces_to_highlight = {  } 

		trigger = {  
			tianlou_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
			}
			jinjiang_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
			}
			# custom_trigger_tooltip = {
			# 	tooltip = gushuokguan_owns_jiangyang_provinces_tt
				north_yanshen_region = {
					type = all
					culture = jiangyang
				is_core = ROOT
				owned_by = ROOT
				OR = {
					local_autonomy = 25
					has_province_modifier = autonomy_increased
					is_capital = no
				}
				NOT = { devastation = 0.01 } 
				NOT = { unrest = 0 }
				if = {
					limit = { ROOT = { has_parliament = yes }  } 
						has_seat_in_parliament = yes 
					}
				}
			# }
		}

		effect = {  
			country_event = {
				id = gushuokguan_event.7
			}
			custom_tooltip = gushuokguan_can_release_guwaamud_tt
			hidden_effect = {
				set_country_flag = gushuokguan_can_release_guwaamud
			}
		} 
	}

	gushuokguan_4_4 = {
		icon = mission_tianlou
		position = 4
		required_missions = { gushuokguan_4_3 } 
		provinces_to_highlight = {  } 

		trigger = {
			iongsim_area = {
				type = all
				is_core = ROOT
				owned_by = ROOT
				OR = {
					local_autonomy = 25
					has_province_modifier = autonomy_increased
				}
				NOT = { devastation = 0.01 }
				NOT = { unrest = 0 }
				if = { 
					limit = { ROOT = { has_parliament = yes } } 
					has_seat_in_parliament = yes 
				}
			}
			NOT = { exists = Y20 } #Feiten
		} 

		effect = {  
			release = Y20 #Feiten
			create_subject = {
				subject_type = dao
				subject = Y20 #Feiten
			} 
			4871 = { #Tianlou
				add_unit_construction = {
					type = light_ship
					cost = 0
					speed = 0.5
					amount = 10
				}
			}
			custom_tooltip = gushuokguan_can_release_zyujyut_tt
			hidden_effect = { set_country_flag = gushuokguan_can_release_zyujyut } 
		}
	}

	gushuokguan_4_5 = {
		icon = mission_rice_farming
		position = 5
		required_missions = {
			gushuokguan_3_4
			gushuokguan_4_4
			gushuokguan_5_4
		}
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_50_vassal_provinces_tt
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					owned_by_subject_of = ROOT #Gushuokguan
					development = 10
					NOT = { devastation = 0.01 } 
					num_of_buildings_in_province = 3
					NOT = { unrest = 0 }
					value = 50
				}
			}
		} 

		effect = {  
			every_subject_country = {
				every_owned_province = {
					limit = {
						development = 10
						NOT = { devastation = 0.01 } 
						num_of_buildings_in_province = 3
					}
					add_province_modifier = {
						name = gushuokguan_confederal_mercantilism
						duration = 18250
					}
				}
			}
			add_country_modifier = {
				name = gushuokguan_the_caring_leader
				duration = -1
			}
		} 
	}

	gushuokguan_4_6 = {
		icon = jap_kirishtan_realm
		position = 6
		required_missions = { gushuokguan_2_5 } 
		provinces_to_highlight = {  } 

		trigger = {  
			num_of_mercenaries = 100 #Average Lategame mission
		} 

		effect = { country_event = { id = gushuokguan_event.20 } } #TODO
	}

	gushuokguan_4_7 = {
		icon = mng_shengshi_zhishi
		position = 7
		required_missions = { gushuokguan_4_6 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_6_stone_army_challenges_tt
				calc_true_if = {
					mission_completed = gushuokguan_1_7
					mission_completed = gushuokguan_1_9
					mission_completed = gushuokguan_2_9
					mission_completed = gushuokguan_3_7
					mission_completed = gushuokguan_3_9
					mission_completed = gushuokguan_4_9
					amount = 6
				}
			}
		} 

		effect = { country_event = { id = gushuokguan_event.20 } } #TODO
	}

	gushuokguan_4_8 = {
		icon = mission_balloon
		position = 8
		required_missions = { gushuokguan_2_7 } 
		provinces_to_highlight = {  } 

		trigger = {  
			Y20 = { #Feiten
				vassal_of = ROOT
				NOT = { liberty_desire = 0 }
			}
			4879 = { #Feiten
				has_fort_building_trigger = yes
				has_shipyard_building_trigger = yes
				has_dock_building_trigger = yes
				has_building = impressment_offices
				infantry_in_province = 10
				artillery_in_province = 10
			}
		} 

		effect = {  
			4879 = { #Feiten
				kill_units = {
					who = ROOT
					type = infantry
					amount = 10
				}
				kill_units = {
					who = ROOT
					type = artillery
					amount = 10
				}
			}
			custom_tooltip = gushuokguan_flying_pebbles_tt
			hidden_effect = {
				set_country_flag = gushuokguan_flying_pebbles
				set_variable = {
					which = gushokguan_siege_counter
					value = 0
				}
			}
		}
	}

	gushuokguan_4_9 = {
		icon = mission_steppe_warriors
		position = 9
		required_missions = { gushuokguan_4_8 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_won_10_sieges_tt
				check_variable = {
					which = gushokguan_siege_counter
					value = 10
				}
			}
			any_war_enemy_country = { #I could do this with another variable to make it more true to the draft. I won't.
				num_of_owned_provinces_with = {
					has_province_modifier = scorched_earth
					value = 20
				}
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_flying_pebbles_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_flying_pebbles }
				disband_mercenary_company = yes
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_flying_pebbles
				set_country_flag = gushuokguan_flying_pebbles_tier_2
			}
		} 
	}
}
gushuokguan_5 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_5_1 = {
		icon = mission_armoury
		position = 1
		provinces_to_highlight = {  } 

		trigger = {  
			# custom_trigger_tooltip = {
			# 	tooltip = gushuokguan_hired_stone_army_tt #In case the tooltip looks bad
				any_hired_mercenary_company = { 
					template = merc_stone_army
				}
			# }
		} 

		effect = {  
			add_country_modifier = {
				name = gushuokguan_guardians_of_the_stone_state
				duration = 7300
			}
			add_country_modifier = {
				name = gushuokguan_home_of_the_stone_army
				duration = -1
			}
		} 
	}

	gushuokguan_5_2 = {
		icon = mission_accomodate_the_rajputs
		position = 2
		required_missions = { gushuokguan_5_1 } 
		provinces_to_highlight = {  } 

		trigger = {
			any_known_country = {
				OR = {
					war_with = R62 #The Command
					capital_scope = {
						region = shamakhad_region
					}
				}
				ROOT = { is_renting_condottieri_to = PREV } #Gushuokguan
			}
		} 

		effect = {  
			4914 = { #Gushibi
				add_hobgoblin_minority_size_effect = yes
				add_base_manpower = 2
			}
			add_army_tradition = 20
		}
	}

	gushuokguan_5_3 = {
		icon = mission_swiss_mercenaries_flipped
		position = 3
		required_missions = { gushuokguan_4_2 } 
		provinces_to_highlight = {  } 

		trigger = {
			OR = {
				AND = {
					army_tradition = 50
					if = {
						limit = { has_country_flag = gushuokguan_stone_army_tier_2 } 
						any_hired_mercenary_company = { template = merc_stone_army_tier_2 } 
					}
					else = { any_hired_mercenary_company = { template = merc_stone_army }  } 
					mil_power = 200
				}
				custom_trigger_tooltip = {
					tooltip = gushuokguan_completed_mercenary_ideas_tt
					has_idea = organised_mercenary_recruitment
				}
			}
			
		}

		effect = { 
			if = { limit = { has_idea = organised_mercenary_recruitment } } #Empty
			else = { add_mil_power = -200 }
			country_event = { id = gushuokguan_event.8 }
		} 
	}

	gushuokguan_5_4 = {
		icon = mng_form_depots
		position = 4
		required_missions = {
			gushuokguan_4_3
			gushuokguan_5_3
		}
		provinces_to_highlight = {  } 

		trigger = {
			custom_trigger_tooltip = {
				tooltip = gushuokguan_25_vassal_provinces_tt
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					owned_by_subject_of = ROOT #Gushuokguan
					development = 10
					NOT = { devastation = 0.01 } 
					num_of_buildings_in_province = 3
					value = 25
				}
			}			
		}

		effect = {
			every_subject_country = {
				every_owned_province = {
					limit = {
						development = 10
						NOT = { devastation = 0.01 } 
						num_of_buildings_in_province = 3
					}
					add_province_modifier = {
						name = gushuokguan_interconfederal_industries_local
						duration = 18250
					}
				}
				add_country_modifier = {
					name = gushuokguan_interconfederal_industries_global
					duration = 18250
				}
				add_trust = {
					who = ROOT
					value = 50
					mutual = yes
				}
			}
		}
	}

	gushuokguan_5_5 = {
		icon = jap_strengthen_bakuhan_system
		position = 5
		required_missions = { gushuokguan_5_4 } 
		provinces_to_highlight = {  } 

		trigger = {  
			all_subject_country = {
				total_development = 150
				NOT = { liberty_desire = 10 }
				has_opinion = {
					who = ROOT #Gushuokguan
					value = 200
				}
				trust = {
					who = ROOT #Gushuokguan
					value = 90
				}
			}
		}

		effect = {  
			country_event = {
				id = gushuokguan_event.9 #Confederal Council
			}
			hidden_effect = {
				set_variable = {
					which = gushuokguan_event_counter
					value = 0
				}
			}
		} 
	}

	gushuokguan_5_6 = {
		icon = jap_balance_shinokosho
		position = 6
		required_missions = {
			gushuokguan_2_5
			gushuokguan_4_5
			gushuokguan_5_5
		}
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_had_5_events_tt
				check_variable = {
					which = gushuokguan_event_counter
					value = 5
				}
			}
			army_size_percentage = 0.8
			AND = {
				Y03 = { vassal_of = ROOT } #Hubao
				Y10 = { vassal_of = ROOT } #Yingzhen
				Y23 = { vassal_of = ROOT } #Zyujyut
				Y96 = { vassal_of = ROOT } #Guwaamud
			}
			yanshen_superregion = {
				country_or_non_sovereign_subject_holds = ROOT #Gushokguan
				NOT = { devastation = 0.01 }
			}
		}

		effect = {  
			country_event = {
				id = gushuokguan_event.20
			}
		} 
	}

	gushuokguan_5_7 = {
		icon = mission_unite_the_deccan
		position = 7
		required_missions = { gushuokguan_5_6 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_civil_war_ended_tt
				OR = {
					has_country_flag = gushuokguan_civil_war_federalist_won
					has_country_flag = gushuokguan_civil_war_confederalist_won
				}
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_5_7_tt
				all_owned_province = {
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { unrest = 0 }
				}
				trade_node_provinces = {
					province_has_center_of_trade_of_level = 2
					has_trade_building_trigger = yes
				}
				capital_scope = {
					development = 30
					has_building = state_house
				}
			}
			all_subject_country = {
				all_owned_province = {
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { unrest = 0 }
				}
				trade_node_provinces = {
					province_has_center_of_trade_of_level = 2
					has_trade_building_trigger = yes
				}
				capital_scope = {
					development = 30
					has_building = state_house
				}
			}
			adm_power = 300
			dip_power = 300
			mil_power = 300
			government_reform_progress = 100
		} 

		effect = {  
			add_adm_power = -300
			add_dip_power = -300
			add_mil_power = -300
			change_government_reform_progress = -100
			if = {
				limit = { has_country_flag = gushuokguan_civil_war_federalist_won }
				#Todo after coding subjects and events
			}
			if = {
				limit = { has_country_flag = gushuokguan_civil_war_confederalist_won }
				#Todo after coding subjects and events
			}
			custom_tooltip = gushuokguan_can_release_one_xia_tt
			hidden_effect = {
				set_country_flag = gushuokguan_can_release_one_xia
			}
		} 
	}
}
